<!DOCTYPE html>
<html lang="zh-CN" class="antialiased scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµå…‰å­˜æ ¹ | Digital Garden v71.7 FULL_RESTORE</title>
    
    <!-- æ ¸å¿ƒ CSS å¼•æ“ -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        leviathan: {
                            bg: '#0c0b0a',
                            surface: 'var(--surface-color)',
                            border: 'var(--border-color)',
                            accent: '#e3b341',
                        }
                    },
                    fontFamily: {
                        serif: ['"Noto Serif SC"', 'serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    animation: {
                        'fade-in-pro': 'fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'slide-up': 'slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'scan-line': 'scanline 8s linear infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'blizzard': 'blizzard 30s linear infinite',
                        'dash': 'dash 2s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(15px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        blizzard: {
                            '0%': { backgroundPosition: '0 0, 0 0, 0 0' },
                            '100%': { backgroundPosition: '400px 1200px, 200px 600px, 100px 400px' }
                        },
                        dash: { from: { strokeDashoffset: '1000' }, to: { strokeDashoffset: '0' } }
                    }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200;400;700&family=JetBrains+Mono:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        :root {
            --glass-blur: 16px; 
            --amber-primary: #e3b341;
            --transition-speed: 2s;
            --surface-color: rgba(20, 25, 30, 0.65);
            --border-color: rgba(255, 255, 255, 0.08);
        }

        html { background-color: #0c0b0a; margin: 0; overflow-x: hidden; }
        
        body { 
            background: #101214;
            color: #ffffff; min-height: 100vh; font-family: "Noto Serif SC", serif;
            position: relative;
            transform: translateZ(0); /* å¼ºåˆ¶ GPU å±‚ */
        }

        /* 1. èƒŒæ™¯å±‚ï¼šCSS å¼ºé” (é˜²é»‘å±) */
        body::before {
            content: "";
            position: fixed; inset: 0; 
            background-size: cover; background-position: center;
            background-repeat: no-repeat;
            z-index: -100;
            background-image: url('https://images.pexels.com/photos/35030856/pexels-photo-35030856.jpeg');
            filter: brightness(0.85) contrast(1.15) sepia(0.05) saturate(0.8);
            transform: translateZ(0); 
            pointer-events: none;
        }

        /* 2. å››å­£ç‰¹æ•ˆå±‚ */
        .seasonal-layer {
            position: fixed; inset: 0; pointer-events: none; z-index: -45;
            opacity: 0; transition: opacity 2s ease; mix-blend-mode: screen;
        }
        .seasonal-layer.active { opacity: 1; }

        @keyframes blizzard {
            0% { background-position: 0 0, 0 0, 0 0; }
            100% { background-position: 400px 1200px, 200px 600px, 100px 400px; }
        }
        .effect-winter {
            background-image: 
                radial-gradient(3px 3px at 100px 50px, rgba(255,255,255,0.9), transparent),
                radial-gradient(5px 5px at 200px 150px, rgba(255,255,255,0.6), transparent),
                radial-gradient(2px 2px at 300px 250px, rgba(255,255,255,0.8), transparent);
            background-size: 500px 500px, 400px 400px, 300px 300px;
            animation: blizzard 20s linear infinite;
        }

        @keyframes petal-fall {
            0% { background-position: 0 0, 0 0; transform: translateY(0) rotate(0deg); }
            100% { background-position: 100px 800px, -50px 600px; transform: translateY(20px) rotate(360deg); }
        }
        .effect-spring {
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(255, 192, 203, 0.6), transparent 80%),
                radial-gradient(circle at 20% 80%, rgba(255, 240, 245, 0.5), transparent 70%);
            background-size: 300px 300px, 500px 500px;
            animation: petal-fall 30s linear infinite;
        }

        @keyframes firefly {
            0%, 100% { opacity: 0.2; transform: translate(0, 0); }
            50% { opacity: 1; transform: translate(10px, -20px); }
        }
        .effect-summer {
            background-image: radial-gradient(2px 2px at 50% 50%, #e3b341, transparent);
            background-size: 200px 200px;
            animation: firefly 8s ease-in-out infinite alternate;
        }

        @keyframes leaf-fall {
            0% { background-position: 0 0; }
            100% { background-position: 100px 1000px; }
        }
        .effect-autumn {
            background-image: linear-gradient(45deg, rgba(217, 119, 6, 0.4) 25%, transparent 25%);
            background-size: 400px 400px;
            animation: leaf-fall 40s linear infinite;
        }
        
        .vignette {
            position: fixed; inset: 0; z-index: -40;
            background: radial-gradient(circle at center, rgba(0,0,0,0) 20%, rgba(5, 8, 16, 0.6) 100%);
            pointer-events: none;
        }

        .layout-container {
            max-width: 1440px; margin: 0 auto; padding: 5rem 2rem;
            position: relative; z-index: 10;
        }

        .titan-matrix {
            display: grid; gap: 1.5rem; grid-template-columns: repeat(1, 1fr);
        }

        @media (min-width: 1024px) {
            .titan-matrix {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: 240px 240px auto auto minmax(480px, auto); 
                padding-bottom: 8rem;
            }
            .card-m1 { grid-column: 1 / span 2; grid-row: 1 / span 2; }
            .card-m3 { grid-column: 3 / span 2; grid-row: 1; }
            .card-m2 { grid-column: 3 / span 2; grid-row: 2; }
            .card-writing { grid-column: 1 / span 4; grid-row: 3; min-height: 380px; }
            .card-m5 { grid-column: 1 / span 4; grid-row: 4; }
            .card-m6 { grid-column: 1 / span 4; grid-row: 5; }
        }

        .glass-cell {
            background: rgba(20, 25, 30, 0.6); 
            backdrop-filter: blur(var(--glass-blur));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 32px; padding: 2rem;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative; overflow: visible; 
        }
        .glass-cell:hover {
            border-color: rgba(227, 179, 65, 0.4);
            transform: translateY(-2px);
            background: rgba(30, 40, 55, 0.75);
            box-shadow: 0 40px 80px -20px rgba(0, 0, 0, 0.7);
        }

        .precision-tag {
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px; text-transform: uppercase;
            letter-spacing: 0.3em; color: rgba(255, 255, 255, 0.4); font-weight: 700;
        }

        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.15); border-radius: 10px; }
        
        .watcher-drawer-width { width: 100%; }
        @media (min-width: 768px) { .watcher-drawer-width { width: 520px; } }

        .auth-glow { color: var(--amber-primary) !important; filter: drop-shadow(0 0 12px var(--amber-primary)); }
        .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; opacity: 0; transform: translateY(15px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* FIX: æ‰¾å›ä¸¢å¤±çš„æŒ‰é’®æ ·å¼ */
        .header-btn-container { position: relative; }
        .header-circle-btn {
            width: 44px; height: 44px; border-radius: 9999px;
            background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(20px); display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header-circle-btn:hover { border-color: rgba(227, 179, 65, 0.5); color: #e3b341; }
        
        .search-pill-expanded {
            width: 240px !important; padding-left: 1rem; justify-content: flex-start !important;
        }

        .dropdown-menu {
            opacity: 0; visibility: hidden; transform: translateY(10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            position: absolute; top: 3.5rem; right: 0;
            background: rgba(12, 13, 17, 0.95); border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(24px); border-radius: 20px; padding: 1.5rem; z-index: 50;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); min-width: 280px;
        }
        .dropdown-menu.active { opacity: 1; visibility: visible; transform: translateY(0) scale(1); }
        
        .asset-compact-item {
            background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px; padding: 0.75rem 1.25rem;
            display: flex; justify-content: space-between; align-items: center;
            transition: all 0.3s ease; margin-bottom: 0.5rem; cursor: pointer;
        }
        .asset-compact-item:hover { background: rgba(227, 179, 65, 0.1); border-color: rgba(227, 179, 65, 0.3); transform: translateX(4px); }

        .chart-wrapper { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .pie-layout { display: flex; flex-direction: row; flex-wrap: nowrap; width: 100%; height: 100%; align-items: center; justify-content: space-between; gap: 1.5rem; }
        .pie-chart { width: 140px; height: 140px; border-radius: 50%; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5); flex-shrink: 0; background: #222; }
        .pie-chart::after { content: ''; position: absolute; inset: 40px; background: #15181e; border-radius: 50%; }
        .pie-label-container { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: none; z-index: 10; }
        .pie-legend { display: flex; flex-direction: column; gap: 0.8rem; justify-content: center; padding-left: 1.5rem; border-left: 1px solid rgba(255,255,255,0.05); flex-grow: 1; min-width: 140px; flex-shrink: 0; }
        .legend-item { display: flex; align-items: center; justify-content: space-between; font-family: 'JetBrains Mono'; font-size: 11px; color: rgba(255,255,255,0.7); width: 100%; white-space: nowrap; }
        .legend-key { display: flex; align-items: center; gap: 0.5rem; }
        .legend-dot { width: 8px; height: 8px; border-radius: 2px; }
        .legend-val { color: #fff; opacity: 0.9; font-weight: bold; margin-left: auto; }

        svg.trend-chart { width: 100%; height: 100%; overflow: visible; }
        .trend-line { fill: none; stroke: var(--amber-primary); stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; animation: dash 2.5s ease-out forwards; filter: drop-shadow(0 0 4px var(--amber-primary)); }
        .trend-area { fill: url(#grad1); stroke: none; opacity: 0; animation: fadeIn 1s ease-out 1s forwards; }
        .grid-line { stroke: rgba(255,255,255,0.05); stroke-width: 1; }
        .trend-point { fill: #0c0b0a; stroke: var(--amber-primary); stroke-width: 2; r: 0; transition: all 0.2s; cursor: pointer; animation: popIn 0.5s ease-out forwards; animation-delay: 2s; }
        .trend-point:hover { r: 6; fill: white; }
        @keyframes popIn { to { r: 3; } }

        .fab-publish {
            position: fixed; bottom: 40px; right: 40px; width: 64px; height: 64px; background: var(--amber-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 30px rgba(227, 179, 65, 0.3); color: #000; font-size: 24px; cursor: pointer; z-index: 100; transition: transform 0.3s; opacity: 0; pointer-events: none; transform: scale(0.8);
        }
        .fab-publish.visible { opacity: 1; pointer-events: auto; transform: scale(1); }
        .fab-publish:hover { transform: scale(1.1) rotate(90deg); }

        /* FIX: æ¸²æŸ“å®‰å…¨ï¼Œç§»é™¤æ¨¡ç³Šé˜²æ­¢èƒŒæ™¯é»‘å± */
        #detailModal { 
            background-color: rgba(10, 10, 10, 0.96); 
            z-index: 300; 
        }
        .detail-card { background: #151618; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 32px; box-shadow: 0 40px 100px -20px rgba(0, 0, 0, 0.9); height: 85vh; max-width: 900px; }
    </style>
</head>
<body class="opacity-0 animate-fade-in-pro">

    <div id="bg-layer-1" class="bg-layer"></div>
    <div id="fx-winter" class="seasonal-layer effect-winter active"></div>
    <div class="vignette"></div>

    <div class="layout-container">
        <!-- å¤´éƒ¨ -->
        <header class="flex flex-col lg:flex-row justify-between items-end gap-10 mb-20">
            <div class="w-full">
                <h1 class="text-5xl lg:text-7xl font-black tracking-[0.2em] font-serif mb-8 hover:text-amber-500 transition-all duration-1000">æµå…‰å­˜æ ¹</h1>
                <div class="h-px w-64 bg-gradient-to-r from-amber-500/60 to-transparent mb-5"></div>
                <p class="text-xs lg:text-sm text-gray-400 italic font-serif opacity-80 tracking-[0.25em] leading-loose">
                    å…·ä½“çš„ç”Ÿæ´»ï¼Œæ˜¯æŠµå¾¡è™šæ— çš„æœ€åä¸€é“é˜²çº¿ã€‚
                </p>
            </div>
            
            <div class="flex flex-col items-end gap-5">
                <div id="clockDisplay" class="font-mono text-[14px] text-amber-500 font-bold tracking-[0.2em] mb-1 drop-shadow-md relative z-50">0000.00.00 00:00:00</div>
                
                <div class="flex items-center gap-4 relative">
                    <!-- Search -->
                    <div class="header-btn-container relative">
                        <div id="searchPill" class="header-circle-btn overflow-hidden w-11 h-11" onclick="GardenOS.ui.activateSearch()">
                            <i id="searchIcon" class="ri-search-line text-lg text-white/50"></i>
                            <input type="text" id="headerSearchInput" onkeyup="GardenOS.ui.search(this.value)" onblur="GardenOS.ui.deactivateSearch()" class="hidden w-full bg-transparent border-0 outline-none text-xs font-mono text-white placeholder-white/30 h-full ml-2" placeholder="SEARCH...">
                        </div>
                    </div>
                    <!-- AI -->
                    <div class="header-btn-container relative">
                        <div id="aiBtn" onclick="GardenOS.ui.toggleDropdown('aiMenu')" class="header-circle-btn h-11 w-11 text-white/50 hover:text-amber-500 hover:border-amber-500/50">
                             <i class="ri-brain-line text-lg"></i>
                        </div>
                        <div id="aiMenu" class="dropdown-menu">
                            <div class="flex items-center gap-2 mb-4">
                                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                <span class="text-[10px] font-mono tracking-widest text-amber-500">DEEPSEEK_ONLINE</span>
                                <span id="aiUsageText" class="text-[9px] text-gray-500 ml-auto">0/15</span>
                            </div>
                            <div class="h-48 overflow-y-auto custom-scroll mb-4 border border-white/5 rounded-xl p-3 bg-black/20 text-xs text-gray-300 font-serif leading-relaxed" id="aiChatLog">
                                <span class="opacity-50">ç¥ç»é“¾è·¯å·²è¿æ¥ã€‚</span>
                            </div>
                            <div class="relative">
                                <input type="text" id="aiHeaderInput" onkeypress="GardenOS.api.handleAIInput(event)" class="w-full bg-white/5 border border-white/10 rounded-lg py-2 pl-3 pr-8 text-xs font-mono text-white outline-none focus:border-amber-500" placeholder="è¯¢é—® AI...">
                                <i class="ri-corner-down-left-line absolute right-2 top-2 text-white/20 text-xs"></i>
                            </div>
                        </div>
                    </div>
                    <!-- Contact -->
                    <div class="header-btn-container relative">
                        <div id="contactBtn" onclick="GardenOS.ui.toggleDropdown('contactMenu')" class="header-circle-btn h-11 w-11 text-white/50 hover:text-amber-500 hover:border-amber-500/50">
                             <i class="ri-signal-tower-line text-lg"></i>
                        </div>
                        <div id="contactMenu" class="dropdown-menu">
                             <div class="flex flex-col gap-3">
                                 <div class="group/c"><div class="text-amber-500/60 text-[9px] font-mono tracking-[0.2em] mb-1 uppercase">Email</div><span class="text-sm font-serif text-white select-all">zjx207656@gmail.com</span></div>
                                 <div class="group/c"><div class="text-amber-500/60 text-[9px] font-mono tracking-[0.2em] mb-1 uppercase">WeChat</div><span class="text-sm font-serif text-white select-all">Zj_6174</span></div>
                             </div>
                        </div>
                    </div>
                    <!-- Season -->
                    <div class="header-circle-btn h-11 w-11 text-white/50 cursor-default" title="Auto Season">
                         <span id="linkDot" class="w-1.5 h-1.5 rounded-full bg-amber-500 animate-pulse"></span>
                    </div>
                    <!-- Login -->
                    <div onclick="GardenOS.ui.toggleLogin(true)" class="header-circle-btn h-11 w-11 text-white/50 hover:text-amber-500 hover:border-amber-500/50 cursor-pointer" title="Login">
                         <i id="lockIcon" class="ri-user-3-line text-lg"></i>
                    </div>
                </div>
            </div>
        </header>

        <main class="titan-matrix">
            <!-- M1: ç”Ÿæ´»åˆ»åº¦ -->
            <div class="glass-cell card-m1 flex flex-col justify-between group h-full relative">
                <div class="absolute top-8 right-8 flex gap-3 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button onclick="GardenOS.ui.openHistory('status')" class="text-white/20 hover:text-amber-500 transition-colors" title="å†å²è®°å½•"><i class="ri-history-line text-xl"></i></button>
                    <button onclick="GardenOS.ui.openQuickEdit()" class="text-white/20 hover:text-amber-500 transition-colors" title="å¿«é€Ÿç¼–è¾‘"><i class="ri-edit-line text-xl"></i></button>
                </div>
                
                <div class="flex-grow">
                    <!-- FIX: æ¢å¤è‹±æ–‡æ ‡ç­¾ -->
                    <span class="precision-tag text-amber-500">LIFE_METRICS</span>
                    <h2 class="text-4xl font-bold font-serif mt-4 mb-8 tracking-wide whitespace-nowrap text-white">ç”Ÿæ´»åˆ»åº¦</h2>
                    <div class="space-y-8">
                        <div>
                            <div class="flex justify-between text-[11px] font-mono opacity-40 mb-3 uppercase tracking-[0.5em]"><span>Entropy_Index</span><span id="valEntropy" class="text-amber-500 font-black">95.00%</span></div>
                            <div class="h-[1px] w-full bg-white/10 relative overflow-hidden"><div class="absolute h-full bg-white w-[95%] shadow-[0_0_20px_white]"></div></div>
                        </div>
                        
                        <!-- ç”Ÿæ´»è®°å½•æ˜¾ç¤ºåŒº -->
                        <div id="lifeLogContainer" class="hidden border-l border-amber-500/20 pl-4 py-2">
                            <span class="precision-tag text-[8px] opacity-40 block mb-3">REC_LIFE_TRACE</span>
                            <div id="lifeLogList" class="space-y-3 max-h-[140px] overflow-y-auto custom-scroll pr-2"></div>
                        </div>

                        <p id="valQuote" class="text-lg italic text-gray-300 font-serif leading-relaxed opacity-90 max-w-sm mt-8">â€œä¸‡ç‰©çš†æœ‰è£‚ç—•ï¼Œé‚£æ˜¯å…‰è¿›æ¥çš„åœ°æ–¹ã€‚â€</p>
                    </div>
                </div>
                
                <div class="flex gap-20 pt-10 border-t border-white/10 mt-6">
                    <div><div class="text-3xl font-mono font-light tracking-tighter"><span id="valWeight">55.0</span> <span class="text-[10px] opacity-30 uppercase font-black">Kg</span></div><div class="precision-tag mt-3 opacity-50">Mass</div></div>
                    <div><div class="text-3xl font-mono font-light tracking-tighter"><span id="valVitality">98</span> <span class="text-[10px] opacity-30 uppercase font-black">En</span></div><div class="precision-tag mt-3 opacity-50">Vitality</div></div>
                </div>
            </div>

            <!-- M3: æ‘„å…¥è®°å½• -->
            <div id="ingestCard" class="glass-cell card-m3 flex flex-col justify-between">
                <div class="flex justify-between items-center mb-8">
                    <span class="precision-tag text-white/40">// INGEST_RECORD</span>
                    <button onclick="GardenOS.ui.openHistory('ingest')" class="text-white/20 hover:text-amber-500 transition-colors" title="View History"><i class="ri-history-line text-xl"></i></button>
                </div>
                <div id="ingestListContainer" class="overflow-y-auto custom-scroll h-full pr-3"><div id="ingestList" class="space-y-6"></div></div>
            </div>

            <!-- M2: æ€ç»´ç¢ç‰‡ -->
            <div id="memoCard" class="glass-cell card-m2 flex flex-col justify-start">
                <div class="flex justify-between items-center mb-6 pb-4 border-b border-white/10">
                    <span class="precision-tag text-amber-500/60 tracking-widest uppercase">Fragmented_Echoes</span>
                    <button onclick="GardenOS.ui.openHistory('memo')" class="text-white/20 hover:text-amber-500 transition-colors" title="View History"><i class="ri-history-line text-xl"></i></button>
                </div>
                <div id="memoList" class="w-full h-full overflow-y-auto custom-scroll pr-3 space-y-6 max-h-[160px]"></div>
            </div>

            <!-- Writing -->
            <div id="writingDeck" class="glass-cell card-writing flex flex-col justify-center items-center relative overflow-hidden group cursor-pointer" onclick="GardenOS.ui.toggleWritingDeck()">
                <div class="absolute inset-0 bg-black/60 group-hover:bg-black/40 transition-colors duration-1000"></div>
                <div id="writingCover" class="text-center relative z-10 transition-all duration-700">
                    <i class="ri-quill-pen-line text-4xl text-amber-500 mb-10 block animate-pulse"></i>
                    <h3 class="text-3xl lg:text-3xl font-serif italic text-white mb-8 tracking-[0.2em] leading-loose">â€œæ–‡å­—æ˜¯æ•è·æ—¶é—´çš„ç½‘ï¼Œ<br>æ‰“ææ²‰æ²¡çš„å²æœˆã€‚â€</h3>
                    <span class="precision-tag tracking-[1em] text-white/20 uppercase">Click to open archive</span>
                </div>
                <div id="writingList" class="hidden w-full max-w-5xl relative z-10 animate-fade-in-pro grid grid-cols-1 md:grid-cols-3 gap-10 p-8">
                     <a href="https://shade-plant-9cc.notion.site/2cd5c4b326c88025b72fd4fd1574d4c9?source=copy_link" target="_blank" class="bg-[#0c0d11]/90 p-10 rounded-[40px] border border-amber-500/20 hover:border-amber-500 hover:bg-black/90 transition-all group/item shadow-3xl relative block transform hover:-translate-y-2 searchable-item">
                        <div class="absolute top-0 left-0 w-1.5 h-full bg-amber-500 rounded-l-[40px]"></div>
                        <div class="flex justify-between items-center mb-6"><h4 class="text-2xl font-serif italic font-bold text-white group-hover/item:text-amber-500">é“œå·å¾€äº‹</h4><i class="ri-external-link-line text-white/30 group-hover/item:text-amber-500 text-2xl"></i></div>
                        <p class="text-sm text-gray-400 font-serif leading-loose opacity-80">è¢«æŠ˜å çš„æ—¶é—´ç¢ç‰‡ï¼Œä¸ªä½“åœ¨å®å¤§å™äº‹ç¼éš™ä¸­çš„å‘¼å¸ã€‚</p>
                        <div class="mt-8"><span class="text-[10px] border border-white/20 px-3 py-1 rounded-full text-white/40 uppercase tracking-wider">Novel</span></div>
                    </a>
                    <div id="dynamicWritingContainer" class="contents"></div>
                </div>
            </div>

            <!-- M5: æ„Ÿå®˜å®éªŒå®¤ -->
            <div class="glass-cell card-m5">
                <div class="flex justify-between items-center mb-12">
                    <span class="precision-tag text-white/30 tracking-[4em] uppercase">// SENSORY_LABORATORY</span>
                    <i class="ri-eye-2-line text-white/10 text-2xl"></i>
                </div>
                <div id="sensoryGrid" class="grid grid-cols-2 md:grid-cols-5 gap-10">
                    <button onclick="GardenOS.ui.openSensoryCategory('anime')" class="flex flex-col items-center gap-5 group/btn searchable-item cursor-pointer hover:scale-105 transition-transform"><div class="w-16 h-16 bg-white/[0.04] rounded-[24px] flex items-center justify-center text-4xl border border-white/5 group-hover/btn:bg-amber-500/20 transition-all shadow-xl">â›©ï¸</div><span class="precision-tag opacity-40 group-hover/btn:opacity-100">Anime</span></button>
                    <button onclick="GardenOS.ui.openSensoryCategory('game')" class="flex flex-col items-center gap-5 group/btn searchable-item cursor-pointer hover:scale-105 transition-transform"><div class="w-16 h-16 bg-white/[0.04] rounded-[24px] flex items-center justify-center text-4xl border border-white/5 group-hover/btn:bg-amber-500/20 transition-all shadow-xl">ğŸ•¹ï¸</div><span class="precision-tag opacity-40 group-hover/btn:opacity-100">Game</span></button>
                    <button onclick="GardenOS.ui.openSensoryCategory('film')" class="flex flex-col items-center gap-5 group/btn searchable-item cursor-pointer hover:scale-105 transition-transform"><div class="w-16 h-16 bg-white/[0.04] rounded-[24px] flex items-center justify-center text-4xl border border-white/5 group-hover/btn:bg-amber-500/20 transition-all shadow-xl">ğŸ¬</div><span class="precision-tag opacity-40 group-hover/btn:opacity-100">Film</span></button>
                    <button onclick="GardenOS.ui.openSensoryCategory('vista')" class="flex flex-col items-center gap-5 group/btn searchable-item cursor-pointer hover:scale-105 transition-transform"><div class="w-16 h-16 bg-white/[0.04] rounded-[24px] flex items-center justify-center text-4xl border border-white/5 group-hover/btn:bg-amber-500/20 transition-all shadow-xl">ğŸŒ²</div><span class="precision-tag opacity-40 group-hover/btn:opacity-100">Vista</span></button>
                    <button onclick="GardenOS.ui.openSensoryCategory('audio')" class="flex flex-col items-center gap-5 group/btn searchable-item cursor-pointer hover:scale-105 transition-transform"><div class="w-16 h-16 bg-white/[0.04] rounded-[24px] flex items-center justify-center text-4xl border border-white/5 group-hover/btn:bg-amber-500/20 transition-all shadow-xl">ğŸ“»</div><span class="precision-tag opacity-40 group-hover/btn:opacity-100">Audio</span></button>
                </div>
            </div>

            <!-- M6: èµ„äº§ç»ˆç«¯ (ä¿®å¤ï¼šå¸ƒå±€ä¸æˆªæ–­) -->
            <div class="glass-cell card-m6 min-h-[440px] pb-16 overflow-visible">
                <div class="flex justify-between items-start mb-14">
                    <span class="precision-tag text-white/30 tracking-[4em] uppercase">WEALTH_PULSE</span>
                    <div class="flex items-center gap-3">
                         <button onclick="GardenOS.ui.switchChart('pie')" id="btnPie" class="text-[10px] text-amber-500 hover:text-white font-bold transition-colors">DISTRIBUTION</button>
                         <span class="text-white/20">|</span>
                         <button onclick="GardenOS.ui.switchChart('trend')" id="btnTrend" class="text-[10px] text-white/50 hover:text-amber-500 font-bold transition-colors">TREND</button>
                    </div>
                </div>
                <div class="flex flex-col lg:flex-row gap-12 h-full">
                    <!-- å·¦ä¾§ï¼šä¸€åˆ—èµ„äº§ -->
                    <div id="assetList" class="w-full lg:w-1/3 flex flex-col gap-2 pr-2 h-full">
                        <!-- JS å¡«å…… -->
                    </div>
                    
                    <!-- å³ä¾§ï¼šå¯è§†åŒ–åŒºåŸŸ -->
                    <div id="vizContainer" class="w-full lg:w-2/3 bg-black/40 rounded-[48px] border border-white/5 relative overflow-hidden flex flex-col items-center justify-center p-8 shadow-inner h-full min-h-[300px]">
                        <!-- é¥¼å›¾ (å·¦å³å¸ƒå±€) -->
                        <div id="pieChart" class="chart-wrapper w-full h-full">
                             <div class="pie-layout">
                                <div class="relative flex-shrink-0"><div class="pie-chart"></div><div class="pie-label-container absolute inset-0 flex flex-col items-center justify-center pointer-events-none"><span class="text-xl font-mono font-bold text-white mb-1" id="totalAssetVal">910</span><span class="text-[9px] tracking-widest text-white/50 uppercase">Total</span></div></div>
                                <div class="pie-legend">
                                    <div class="legend-item"><div class="legend-key"><div class="legend-dot bg-[#e3b341]"></div> FUNDS</div> <span id="legFundsVal" class="legend-val">0</span></div>
                                    <div class="legend-item"><div class="legend-key"><div class="legend-dot bg-[#10b981]"></div> STOCKS</div> <span id="legStocksVal" class="legend-val">0</span></div>
                                    <div class="legend-item"><div class="legend-key"><div class="legend-dot bg-[#3b82f6]"></div> CRYPTO</div> <span id="legCryptoVal" class="legend-val">0</span></div>
                                    <div class="legend-item"><div class="legend-key"><div class="legend-dot bg-[#a8a29e]"></div> METAL</div> <span id="legMetalVal" class="legend-val">0</span></div>
                                </div>
                             </div>
                        </div>
                        
                        <!-- è¶‹åŠ¿å›¾ -->
                        <div id="trendChart" class="chart-wrapper hidden w-full h-full relative p-4">
                            <svg class="trend-chart" viewBox="0 0 300 150">
                                <defs><linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:rgb(227, 179, 65);stop-opacity:0.2" /><stop offset="100%" style="stop-color:rgb(227, 179, 65);stop-opacity:0" /></linearGradient></defs>
                                <path class="trend-area" d="" fill="url(#grad1)"/>
                                <polyline class="trend-line" points="" style="fill:none;stroke:#e3b341;stroke-width:2;" />
                            </svg>
                            <div id="xAxisLabels" class="absolute bottom-2 left-0 w-full flex justify-between px-6 pointer-events-none"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <div id="fabPublish" onclick="GardenOS.ui.toggleWatcher(true)" class="fab-publish"><i class="ri-add-line"></i></div>
    </div>

    <!-- ä¾§è¾¹æ ï¼šå‘å¸ƒä¸­å¿ƒ -->
    <aside id="watcherDrawer" class="fixed top-0 right-[-100%] h-full bg-[#0c0b0a]/98 backdrop-blur-3xl border-l border-white/10 z-[200] transition-all duration-1000 cubic-bezier(0.16, 1, 0.3, 1) p-12 flex flex-col no-scrollbar shadow-3xl overflow-y-auto watcher-drawer-width">
        <div class="flex justify-between items-center mb-12">
            <h2 class="text-3xl font-serif italic font-black tracking-[0.2em] uppercase text-white">å‘å¸ƒä¸­å¿ƒ</h2>
            <button onclick="GardenOS.ui.toggleWatcher(false)" class="p-4 text-2xl text-gray-500 hover:text-white transition-all hover:rotate-90">âœ•</button>
        </div>
        <div class="flex-grow flex flex-col">
            <div id="adminPostArea" class="hidden mb-12 p-8 bg-white/[0.02] border border-amber-500/20 rounded-[48px] space-y-6 animate-fade-in-pro shadow-2xl">
                <div class="flex justify-between items-center mb-4"><span class="precision-tag text-amber-500 font-black tracking-[0.5em] uppercase">å‘å¸ƒé¢æ¿</span><div class="w-2.5 h-2.5 bg-green-500 rounded-full animate-ping"></div></div>
                <div class="space-y-5">
                    <select id="postTarget" onchange="GardenOS.ui.updateInputLabels()" class="w-full bg-black/70 border border-white/10 rounded-xl p-5 text-xs font-mono text-white outline-none focus:border-amber-500 cursor-pointer">
                        <option value="memo">ç¢ç¢å¿µ</option><option value="writing">å†™ä½œåŒº</option><option value="ingest">æ‘„å…¥è®°å½•</option><option value="sensory">æ„Ÿå®˜åŒº</option><option value="assets">èµ„äº§å˜åŠ¨</option><option value="status">ç”Ÿå‘½ä½“å¾</option><option value="life">ç”Ÿæ´»è®°å½•</option>
                    </select>
                    
                    <div class="relative">
                        <label id="lblTitle" class="absolute -top-2 left-4 text-[9px] text-amber-500 bg-[#151618] px-1 hidden">AMOUNT</label>
                        <input type="text" id="postTitle" class="w-full bg-black/70 border border-white/10 rounded-xl p-5 text-xs font-mono text-white outline-none focus:border-amber-500" placeholder="æ ‡é¢˜ / ä¹¦å / é‡‘é¢">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="linkText" class="bg-black/70 border border-white/10 rounded-xl p-5 text-xs font-mono text-white outline-none focus:border-amber-500" placeholder="åˆ†ç±» / æ ‡ç­¾">
                        <input type="text" id="linkUrl" class="bg-black/70 border border-white/10 rounded-xl p-5 text-xs font-mono text-white outline-none focus:border-amber-500" placeholder="URL é“¾æ¥">
                    </div>

                    <input type="text" id="postImage" class="w-full bg-black/70 border border-white/10 rounded-xl p-5 text-xs font-mono text-white outline-none focus:border-amber-500" placeholder="å›¾ç‰‡ URL / æ•°å€¼">
                    
                    <div class="relative">
                        <label id="lblContent" class="absolute -top-2 left-4 text-[9px] text-amber-500 bg-[#151618] px-1 hidden">SENTIMENT</label>
                        <textarea id="postContent" class="w-full bg-black/70 border border-white/10 rounded-xl p-5 text-xs font-serif italic text-gray-300 outline-none focus:border-amber-500 h-36" placeholder="æ„Ÿæ‚Ÿ / è¯¦æƒ…..."></textarea>
                    </div>
                    
                    <div class="flex items-center gap-3 px-1">
                        <input type="checkbox" id="postPrivate" class="w-4 h-4 accent-amber-500 bg-black/50 border-white/10 rounded cursor-pointer">
                        <label for="postPrivate" class="text-[10px] font-mono text-gray-400 tracking-wider cursor-pointer select-none">ğŸ”’ å®Œå…¨éšç§</label>
                    </div>

                    <button onclick="GardenOS.cms.createPost()" class="w-full py-5 bg-amber-500 text-black font-black uppercase tracking-[0.8em] text-[10px] rounded-2xl shadow-glow active:scale-95 transition-all">æ‰§è¡Œå‘å¸ƒ</button>
                </div>
            </div>
            <div id="aiResponseSide" class="min-h-[120px] font-serif italic text-gray-400 p-8 bg-white/[0.01] rounded-[32px] border-l-4 border-white/10 mb-8 leading-relaxed text-sm"><span class="text-white/20 font-mono uppercase text-[10px]">System Log:</span> ç­‰å¾…å‘å¸ƒæŒ‡ä»¤...</div>
        </div>
    </aside>

    <!-- Detail Modal -->
    <div id="detailModal" class="fixed inset-0 z-[200] hidden items-center justify-center p-6" onclick="GardenOS.ui.closeDetail()">
        <div class="detail-card w-full max-w-5xl h-[85vh] bg-[#151618] border border-white/10 rounded-[32px] p-12 relative shadow-2xl flex flex-col" onclick="event.stopPropagation()">
            <button onclick="GardenOS.ui.closeDetail()" class="absolute top-8 right-8 text-gray-500 hover:text-white transition-colors z-20"><i class="ri-close-line text-3xl"></i></button>
            <div id="detailContent" class="flex-grow space-y-6 overflow-y-auto custom-scroll pr-4"></div>
        </div>
    </div>

    <div id="loginModal" class="fixed inset-0 bg-black/98 z-[500] hidden items-center justify-center p-6 backdrop-blur-3xl">
        <div class="bg-[#0c0d11] p-12 rounded-[56px] border border-white/10 w-full max-w-md text-center shadow-3xl relative overflow-hidden">
            <span class="precision-tag mb-10 block tracking-[0.6em] text-amber-500 font-black relative z-10 uppercase">Identity Auth</span>
            <input type="password" id="authKeyInput" class="w-full bg-white/5 border border-white/10 rounded-[32px] p-8 text-center text-2xl font-mono text-white mb-10 tracking-[0.5em] focus:border-amber-500 outline-none shadow-inner relative z-10" autocomplete="new-password">
            <div class="flex gap-5 relative z-10"><button onclick="GardenOS.ui.toggleLogin(false)" class="flex-1 precision-tag py-6 hover:text-white transition-all tracking-[0.5em] text-[10px] uppercase">Abort</button><button onclick="GardenOS.auth.verify()" class="flex-1 py-6 bg-white/5 border border-white/10 rounded-[24px] font-black text-amber-500 tracking-[1em] text-[11px] hover:bg-white/10 active:scale-95 transition-all shadow-xl uppercase">Connect</button></div>
        </div>
    </div>

    <script>
        const GardenOS = {
            config: { secret: 'Zjx207661', storageKey: 'garden_v71_7_db', deepSeekApiKey: 'sk-437d432e53664e489b60a9349619a879', dailyLimit: 15, visitorLimit: 5 },
            data: {
                // æ¢å¤é»˜è®¤ç»“æ„
                defaultContent: {
                    assets: [
                        {title: '01 // FUNDS', content: '700.00', val: 700},
                        {title: '02 // STOCKS', content: '0.00', val: 0},
                        {title: '03 // CRYPTO', content: '150.00', val: 150},
                        {title: '04 // METAL', content: '60.00 GR', val: 60}
                    ],
                    ingest: { title: 'ã€ŠçŒ®ç»™é˜¿å°”å‰ä¾¬çš„èŠ±æŸã€‹', content: 'æ™ºæ…§æ˜¯å­¤ç‹¬çš„è§£è¯ã€‚', image: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-4.0.3&auto=format&fit=crop&w=100' },
                    memo: 'â€œå²æœˆä¸è¯­ï¼Œå”¯æœ‰æ–‡å­—èƒ½åœ¨å¤§é›ªä¸­å–æš–ã€‚â€'
                }
            },
            state: { isAuthorized: false, currentSeason: 'winter', currentPhase: 'night' },

            boot() {
                // FIX: Force Clear BG JS Control
                const bg = document.getElementById('bg-layer-1');
                if(bg) bg.style.cssText = ""; 

                this.auth.init();
                this.environment.init(); // åŒ…å«æ—¶é—´æ›´æ–°
                this.ui.init();
                this.cms.renderAll();
                setTimeout(() => this.ui.activateAnimations(), 500); 
                
                const inp = document.getElementById('authKeyInput');
                if(inp) inp.value = '';
            },

            api: {
                getUsage() { const t=new Date().toDateString(), u=JSON.parse(localStorage.getItem('garden_ai_usage')||'{}'); return u.date!==t?{date:t,count:0}:u; },
                updateUsage(c) { localStorage.setItem('garden_ai_usage', JSON.stringify({date:new Date().toDateString(),count:c})); document.getElementById('aiUsageText').innerText=`${c}/15`; },
                async handleAIInput(e) {
                    if (e.key === 'Enter') {
                        const val = e.target.value.trim(); if (!val) return;
                        const usage = this.getUsage();
                        if (usage.count >= GardenOS.config.dailyLimit) { this.typewriter("Limit reached.", `ai_${Date.now()}`); e.target.disabled = true; return; }
                        const log = document.getElementById('aiChatLog'); log.innerHTML+=`<div class="mb-2 text-white">> ${val}</div>`; e.target.value='';
                        const lid = Date.now(); log.innerHTML+=`<div id="r_${lid}" class="text-amber-500 mb-4 opacity-50">Thinking...</div>`;
                        
                        // AI å…¨ç«™æ„ŸçŸ¥
                        const siteData = JSON.parse(localStorage.getItem(GardenOS.config.storageKey) || '{}');
                        const posts = siteData.posts || [];
                        const recentPosts = posts.slice(0, 5).map(p => `[${p.target}] ${p.title}: ${p.content}`).join('\n');
                        const context = `[Current Site Status]\nSite Title: æµå…‰å­˜æ ¹\nUser Auth: ${GardenOS.state.isAuthorized ? 'Admin' : 'Visitor'}\nStats: Weight ${siteData.status?.weight}kg, Vitality ${siteData.status?.vitality}\nRecent Activity:\n${recentPosts}`;

                        const res = await this.callDeepSeek(val, context);
                        document.getElementById(`r_${lid}`).remove();
                        const id = Date.now(); log.innerHTML+=`<div id="res_${id}" class="text-amber-500 mb-4 text-xs font-mono"></div>`;
                        this.typewriter(res, `res_${id}`);
                        this.updateUsage(usage.count+1);
                    }
                },
                async callDeepSeek(p, c) {
                    if(!GardenOS.config.deepSeekApiKey) return "[OFFLINE]";
                    try {
                        const r = await fetch('https://api.deepseek.com/chat/completions', { method:'POST', headers:{'Content-Type':'application/json','Authorization':`Bearer ${GardenOS.config.deepSeekApiKey}`}, body:JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:c},{role:"user",content:p}]})});
                        const d = await r.json(); return d.choices[0].message.content;
                    } catch(e) { return "Error: "+e.message; }
                },
                typewriter(t, id) { const el=document.getElementById(id); let i=0; const tm=setInterval(()=>{ if(!el) return clearInterval(tm); el.innerText+=t.charAt(i++); if(i>=t.length) clearInterval(tm); }, 20); }
            },

            auth: {
                init() {
                    const stored = JSON.parse(localStorage.getItem(GardenOS.config.storageKey) || '{}');
                    if(stored.isAuthorized) { GardenOS.state.isAuthorized = true; GardenOS.ui.updateAuthUI(true); }
                },
                verify() {
                    const val = document.getElementById('authKeyInput').value;
                    if (val === GardenOS.config.secret) {
                        GardenOS.state.isAuthorized = true;
                        localStorage.setItem(GardenOS.config.storageKey, JSON.stringify({isAuthorized:true}));
                        GardenOS.ui.toggleLogin(false); GardenOS.ui.updateAuthUI(true);
                        GardenOS.cms.renderAll();
                    } else { /* Error visual */ }
                }
            },

            environment: {
                init() {
                    setInterval(() => { 
                        const d = new Date();
                        const dateStr = d.getFullYear() + '.' + String(d.getMonth()+1).padStart(2,'0') + '.' + String(d.getDate()).padStart(2,'0');
                        const timeStr = d.toLocaleTimeString('en-GB', { hour12: false });
                        document.getElementById('clockDisplay').innerText = `${dateStr} ${timeStr}`;
                    }, 1000);
                }
            },

            ui: {
                init() { 
                   document.getElementById('writingList').classList.add('hidden'); 
                },
                activateAnimations() { document.querySelector('.layout-container').classList.add('opacity-100'); },
                toggleLogin(s) { document.getElementById('loginModal').style.display=s?'flex':'none'; },
                toggleWatcher(s) { document.getElementById('watcherDrawer').style.right=s?'0':'-100%'; },
                toggleDropdown(id) { const el = document.getElementById(id); ['contactMenu', 'aiMenu'].forEach(mid => { if (mid !== id) document.getElementById(mid).classList.remove('active'); }); el.classList.toggle('active'); },
                toggleWritingDeck() { document.getElementById('writingCover').classList.toggle('hidden'); document.getElementById('writingList').classList.toggle('hidden'); },
                activateSearch() { document.getElementById('searchPill').style.width='240px'; document.getElementById('headerSearchInput').classList.remove('hidden'); document.getElementById('headerSearchInput').focus(); },
                deactivateSearch() { if(!document.getElementById('headerSearchInput').value) { document.getElementById('headerSearchInput').classList.add('hidden'); document.getElementById('searchPill').style.width='44px'; } },
                search(v) { document.querySelectorAll('.searchable-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(v.toLowerCase())?'':'none'); },
                updateAuthUI(auth) { if(auth) { document.getElementById('lockIcon').className='ri-shield-user-line text-amber-500'; document.getElementById('adminPostArea').classList.remove('hidden'); document.getElementById('fabPublish').classList.add('visible'); } },
                switchChart(t) { document.getElementById('pieChart').classList.toggle('hidden', t!=='pie'); document.getElementById('trendChart').classList.toggle('hidden', t!=='trend'); },
                
                updateInputLabels() {
                    const target = document.getElementById('postTarget').value;
                    const titleInput = document.getElementById('postTitle');
                    const contentInput = document.getElementById('postContent');
                    const lblTitle = document.getElementById('lblTitle');
                    const lblContent = document.getElementById('lblContent');
                    
                    if (target === 'assets') {
                        titleInput.placeholder = "é‡‘é¢ (e.g. 1000.00)";
                        contentInput.placeholder = "æ„Ÿæ‚Ÿ / å¤‡æ³¨...";
                        lblTitle.innerText = "AMOUNT"; lblContent.innerText = "SENTIMENT";
                        lblTitle.classList.remove('hidden'); lblContent.classList.remove('hidden');
                        document.getElementById('linkText').placeholder = "CATEGORY (Funds/Crypto/etc)"; 
                    } else if (target === 'status') {
                        titleInput.placeholder = "ä½“é‡ (e.g. 55.0)";
                        contentInput.placeholder = "è¯­å½•...";
                        lblTitle.innerText = "WEIGHT"; lblContent.innerText = "QUOTE";
                        lblTitle.classList.remove('hidden'); lblContent.classList.remove('hidden');
                        document.getElementById('linkText').placeholder = "ENTROPY"; 
                        document.getElementById('postImage').placeholder = "VITALITY";
                    } else if (target === 'life') {
                        lblTitle.innerText = "ACTIVITY"; lblContent.innerText = "DETAIL";
                        titleInput.placeholder = "é¡¹ç›® (å¦‚: å¥èº«æˆ¿)"; contentInput.placeholder = "æ·±è¹² 100kg...";
                        document.getElementById('linkText').placeholder = "æ—¶é•¿/æ¶ˆè€—"; 
                    } else {
                        titleInput.placeholder = "æ ‡é¢˜ / ä¹¦å";
                        contentInput.placeholder = "å†…å®¹...";
                        lblTitle.classList.add('hidden'); lblContent.classList.add('hidden');
                        document.getElementById('linkText').placeholder = "åˆ†ç±» / æ ‡ç­¾";
                    }
                },
                
                openQuickEdit() {
                    this.toggleWatcher(true);
                    document.getElementById('postTarget').value = 'status';
                    this.updateInputLabels();
                },

                openHistory(type) {
                     const modal = document.getElementById('detailModal');
                     const content = document.getElementById('detailContent');
                     modal.style.display = 'flex';
                     
                     const data = JSON.parse(localStorage.getItem(GardenOS.config.storageKey) || '{}');
                     let posts = (data.posts || []).filter(p => p.target === type).sort((a,b)=>b.id-a.id);
                     if (!GardenOS.state.isAuthorized) {
                         posts = posts.filter(p => !p.isPrivate).slice(0, GardenOS.config.visitorLimit);
                     }
                     
                     let html = `<h2 class="text-4xl font-serif italic text-white mb-10 border-b border-white/10 pb-6 tracking-wide">${type.toUpperCase()} ARCHIVE</h2>`;
                     
                     if (posts.length === 0) {
                         html += '<p class="text-gray-500 italic text-xl">æš‚æ— å…¬å¼€è®°å½•ã€‚</p>';
                     } else {
                         html += '<div class="space-y-8">';
                         posts.forEach(p => {
                              const date = p.timestamp || new Date(p.id).toLocaleString();
                              html += `
                                 <div class="bg-white/5 p-8 rounded-3xl border border-white/5 hover:border-amber-500/30 transition-all">
                                     <div class="flex justify-between items-center mb-4">
                                         <h4 class="font-bold text-white text-xl">${p.title}</h4>
                                         <span class="text-xs text-gray-500 font-mono">${date} ${p.isPrivate ? 'ğŸ”’' : ''}</span>
                                     </div>
                                     <p class="text-base text-gray-300 leading-relaxed font-serif">${p.content}</p>
                                     ${p.image ? `<img src="${p.image}" class="mt-6 w-full h-64 object-cover rounded-2xl opacity-90">` : ''}
                                     ${p.link ? `<a href="${p.link.url}" target="_blank" class="text-sm text-amber-500 mt-4 inline-block hover:underline">ğŸ”— ${p.link.text || 'Link'}</a>` : ''}
                                 </div>
                              `;
                         });
                         html += '</div>';
                     }
                     content.innerHTML = html;
                },

                openDetail(type, dataStr) {
                    const data = JSON.parse(decodeURIComponent(dataStr));
                    const modal = document.getElementById('detailModal');
                    const content = document.getElementById('detailContent');
                    modal.style.display = 'flex';
                    
                    let html = '';
                    if (type === 'asset') {
                        const allData = JSON.parse(localStorage.getItem(GardenOS.config.storageKey) || '{}');
                        const catKey = data.title.split(' // ')[1] || data.title;
                        let history = (allData.posts || []).filter(p => p.target === 'assets' && p.link && p.link.text && p.link.text.includes(catKey));
                        history.sort((a, b) => b.id - a.id);
                        
                        if (!GardenOS.state.isAuthorized) {
                            history = history.filter(p => !p.isPrivate).slice(0, GardenOS.config.visitorLimit);
                        }

                        html = `
                            <span class="precision-tag text-amber-500 mb-2 block tracking-[0.2em]">ASSET_DETAIL</span>
                            <h2 class="text-5xl font-mono text-white mb-8">${data.title}</h2>
                            <div class="text-7xl font-mono text-white mb-10 tracking-tighter">${data.content}</div>
                            <div class="h-px w-full bg-white/10 mb-8"></div>
                            <h4 class="text-sm font-bold text-gray-400 mb-6 tracking-widest">HISTORY & SENTIMENT</h4>
                            <div class="space-y-4">
                                ${history.length ? history.map(h => `
                                    <div class="bg-white/5 p-6 rounded-2xl border border-white/5 flex justify-between items-center">
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1 font-mono">${h.timestamp} ${h.isPrivate ? 'ğŸ”’' : ''}</div>
                                            <p class="text-base text-gray-300 font-serif italic">"${h.content}"</p>
                                        </div>
                                        <div class="text-xl font-mono text-white">${h.title}</div>
                                    </div>
                                `).join('') : '<p class="text-gray-500 italic">No history records found.</p>'}
                            </div>
                        `;
                    } else if (type === 'generic') {
                        html = `
                            <span class="precision-tag text-amber-500 mb-6 block tracking-[0.2em]">${data.target ? data.target.toUpperCase() : 'DETAIL'}_LOG</span>
                            <h2 class="text-4xl font-serif text-white mb-6 leading-tight">${data.title}</h2>
                            ${data.image ? `<img src="${data.image}" class="w-full h-80 object-cover rounded-3xl mb-8 shadow-2xl">` : ''}
                            <p class="text-lg text-gray-300 font-serif leading-loose">${data.content}</p>
                            ${data.link ? `<a href="${data.link.url}" target="_blank" class="mt-8 inline-block text-amber-500 border-b border-amber-500 pb-1 text-lg">Open Link â†—</a>` : ''}
                        `;
                    }
                    content.innerHTML = html;
                },
                closeDetail() { document.getElementById('detailModal').style.display = 'none'; },
                
                openSensoryCategory(cat) {
                     const modal = document.getElementById('detailModal');
                     const content = document.getElementById('detailContent');
                     modal.style.display = 'flex';
                     
                     const data = JSON.parse(localStorage.getItem(GardenOS.config.storageKey) || '{}');
                     let posts = (data.posts || []).filter(p => p.target === 'sensory' && (!p.link || p.link.text.toLowerCase().includes(cat))).sort((a,b)=>b.id-a.id);
                     
                     if (!GardenOS.state.isAuthorized) {
                         posts = posts.filter(p => !p.isPrivate).slice(0, GardenOS.config.visitorLimit);
                     }
                     
                     content.innerHTML = `
                        <h2 class="text-4xl font-serif italic text-white mb-10 border-b border-white/10 pb-6">${cat.toUpperCase()} ARCHIVE</h2>
                        <div class="grid grid-cols-1 gap-6">
                            ${posts.length ? posts.map(p => `
                                <div class="bg-white/5 p-6 rounded-2xl cursor-pointer hover:bg-white/10 transition-colors flex gap-6 items-start" onclick='GardenOS.ui.openDetail("generic", "${encodeURIComponent(JSON.stringify(p))}")'>
                                    ${p.image ? `<img src="${p.image}" class="w-32 h-32 object-cover rounded-xl flex-shrink-0">` : ''}
                                    <div>
                                        <div class="flex items-center gap-2 mb-2">
                                            <h4 class="font-bold text-lg text-white">${p.title}</h4>
                                            ${p.isPrivate ? '<span class="text-xs text-amber-500">ğŸ”’</span>' : ''}
                                        </div>
                                        <p class="text-sm text-gray-400 line-clamp-3 leading-relaxed">${p.content}</p>
                                    </div>
                                </div>
                            `).join('') : '<p class="text-gray-500 text-lg">No records yet.</p>'}
                        </div>
                     `;
                },

                // Proxy
                drawCharts(t, b) { 
                     const pieEl = document.querySelector('.pie-chart');
                    if(!pieEl) return;
                    
                    const p1 = (b.funds/t)*100 || 0;
                    const p2 = p1 + (b.stocks/t)*100 || 0;
                    const p3 = p2 + (b.crypto/t)*100 || 0;
                    setTimeout(() => { pieEl.style.background = `conic-gradient(#e3b341 0% ${p1}%, #10b981 ${p1}% ${p2}%, #3b82f6 ${p2}% ${p3}%, #a8a29e ${p3}% 100%)`; }, 100);
                    document.getElementById('totalAssetVal').innerText = t;
                    
                    // FIX: Ensure ID exists
                    if(document.getElementById('legFundsVal')) document.getElementById('legFundsVal').innerText = `${b.funds} (${Math.round(p1)}%)`;
                    if(document.getElementById('legStocksVal')) document.getElementById('legStocksVal').innerText = `${b.stocks} (${Math.round(p2-p1)}%)`;
                    if(document.getElementById('legCryptoVal')) document.getElementById('legCryptoVal').innerText = `${b.crypto} (${Math.round(p3-p2)}%)`;
                    if(document.getElementById('legMetalVal')) document.getElementById('legMetalVal').innerText = `${b.metal} (${Math.round(100-p3)}%)`;

                    const trendData = [];
                    for(let i=6; i>0; i--) { trendData.push(Math.floor(t * (1 + (Math.random()*0.1-0.05)))); }
                    trendData.push(t);
                    const min = Math.min(...trendData) * 0.95;
                    const max = Math.max(...trendData) * 1.05;
                    const range = max - min;
                    const points = trendData.map((val, idx) => {
                        const x = idx * 50; 
                        const y = 150 - ((val - min) / range * 130 + 10); 
                        return `${x},${y}`;
                    }).join(' ');
                    
                    const svg = document.querySelector('.trend-chart');
                    if(svg) {
                        const area = svg.querySelector('.trend-area');
                        const line = svg.querySelector('.trend-line');
                        const axisContainer = document.getElementById('xAxisLabels');
                        
                        if(area) area.setAttribute('d', `M0,150 L${points.split(' ').join(' L')} L300,150 Z`);
                        if(line) line.setAttribute('points', points);
                        svg.querySelectorAll('circle').forEach(c => c.remove());
                        
                        if(axisContainer) axisContainer.innerHTML = '';
                        const days = [];
                        for(let i=6; i>=0; i--) {
                            const d = new Date(); d.setDate(d.getDate() - i);
                            days.push(d.toLocaleDateString('en-US', {weekday:'short'}));
                        }

                        trendData.forEach((val, idx) => {
                             const x = idx * 50;
                             const y = 150 - ((val - min) / range * 130 + 10);
                             const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                             circle.setAttribute("cx", x); circle.setAttribute("cy", y); circle.setAttribute("class", "trend-point");
                             const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
                             title.textContent = `${days[idx]}: ${val}`;
                             circle.appendChild(title);
                             svg.appendChild(circle);
                             
                             if(axisContainer) {
                                 const label = document.createElement('div');
                                 label.className = "text-[9px] text-white/30 font-mono absolute";
                                 label.style.left = `${(idx/6)*100}%`;
                                 label.style.transform = "translateX(-50%)";
                                 label.innerText = days[idx];
                                 axisContainer.appendChild(label);
                             }
                        });
                    }
                }
            },

            cms: {
                createPost() {
                    if(!GardenOS.state.isAuthorized) return;
                    const target = document.getElementById('postTarget').value;
                    const title = document.getElementById('postTitle').value.trim();
                    const content = document.getElementById('postContent').value.trim();
                    const lText = document.getElementById('linkText').value.trim();
                    const lUrl = document.getElementById('linkUrl').value.trim();
                    const img = document.getElementById('postImage').value.trim();
                    const isPrivate = document.getElementById('postPrivate').checked;

                    // FIX: Status Update Logic (Double Write)
                    if (target === 'status') {
                        const data = JSON.parse(localStorage.getItem(GardenOS.config.storageKey) || '{}');
                        data.status = { weight: title, vitality: img, entropy: lText, quote: content };
                        
                        const historyPost = {
                            id: Date.now(),
                            target: 'status_log', // Used for history
                            title: 'Status Update',
                            content: `Weight: ${title}, Vitality: ${img}, Entropy: ${lText}, Quote: "${content}"`,
                            timestamp: new Date().toLocaleString(),
                            isPrivate: isPrivate
                        };
                        const posts = data.posts || []; posts.unshift(historyPost); data.posts = posts;
                        localStorage.setItem(GardenOS.config.storageKey, JSON.stringify(data));
                        GardenOS.cms.renderAll(); 
                        return;
                    }

                    if(!title) return;

                    const post = { 
                        id: Date.now(), 
                        target, title, content, 
                        link: {text:lText, url:lUrl}, 
                        image: img, 
                        isPrivate: isPrivate, 
                        timestamp: new Date().toLocaleString() 
                    };
                    
                    const data = JSON.parse(localStorage.getItem(GardenOS.config.storageKey) || '{}');
                    const posts = data.posts || []; posts.unshift(post); data.posts = posts;
                    localStorage.setItem(GardenOS.config.storageKey, JSON.stringify(data));
                    
                    ['postTitle','postContent','linkText','linkUrl','postImage'].forEach(id => document.getElementById(id).value = '');
                    document.getElementById('postPrivate').checked = false;
                    
                    GardenOS.cms.renderAll();
                },
                renderAll() {
                    const d = JSON.parse(localStorage.getItem(GardenOS.config.storageKey)||'{}');
                    // FIX: Sort Global Posts Chronologically Descending
                    const posts = (d.posts || []).sort((a,b) => b.id - a.id);
                    
                    // Update Status Display
                    if(d.status) {
                        document.getElementById('valWeight').innerText = d.status.weight || '55.0';
                        document.getElementById('valVitality').innerText = d.status.vitality || '98';
                        document.getElementById('valEntropy').innerText = d.status.entropy || '95.00%';
                        document.getElementById('valQuote').innerText = d.status.quote || 'ä¸‡ç‰©çš†æœ‰è£‚ç—•ï¼Œé‚£æ˜¯å…‰è¿›æ¥çš„åœ°æ–¹ã€‚';
                    }

                    // Visitor Filter
                    let visiblePosts = posts;
                    if (!GardenOS.state.isAuthorized) {
                        visiblePosts = posts.filter(p => !p.isPrivate).slice(0, GardenOS.config.visitorLimit);
                    }
                    
                    const c = { memo: document.getElementById('memoList'), ingest: document.getElementById('ingestList'), assets: document.getElementById('assetList'), life: document.getElementById('lifeLogList'), lifeContainer: document.getElementById('lifeLogContainer') };
                    c.memo.innerHTML=''; c.ingest.innerHTML=''; c.assets.innerHTML = ''; c.life.innerHTML = '';

                    // Life Logs
                    const logs = visiblePosts.filter(p => p.target === 'life').slice(0, 4);
                    if(logs.length) {
                        c.lifeContainer.classList.remove('hidden');
                        logs.forEach(l => c.life.innerHTML += `<div class="flex justify-between text-xs py-2 border-b border-white/5 last:border-0"><span class="text-amber-500 font-bold font-mono">${l.title}</span><span class="text-gray-400 font-serif italic">${l.content}</span></div>`);
                    } else { c.lifeContainer.classList.add('hidden'); }

                    const defAssets = GardenOS.data.defaultContent.assets;
                    const keys = ['FUNDS', 'STOCKS', 'CRYPTO', 'METAL'];
                    const map = ['åŸºé‡‘', 'è‚¡ç¥¨', 'åŠ å¯†è´§å¸', 'è´µé‡‘å±'];
                    let totalValue = 0;
                    let breakdown = { funds: 0, stocks: 0, crypto: 0, metal: 0 };
                    
                    const assetMix = [];
                    // FIX: userAssets logic
                    const userAssets = visiblePosts.filter(p=>p.target==='assets');

                    keys.forEach((key, idx) => {
                         // Find latest *authorized* post for this key
                         const latest = userAssets.find(p => p.link && p.link.text && p.link.text.includes(key));
                         if(latest) {
                             assetMix.push(latest);
                         } else {
                             assetMix.push(defAssets[idx]);
                         }
                    });
                    
                    assetMix.forEach((p, idx) => {
                        let valStr = p.title; 
                        let displayTitle = p.title;
                        let displayVal = p.content;

                        if (p.target === 'assets') {
                             const cat = p.link.text || 'ASSET';
                             displayTitle = `0${idx+1} // ${cat}`;
                             displayVal = p.title; 
                             valStr = p.title;
                        } else {
                            // Default Asset Item
                             displayTitle = p.title;
                             displayVal = p.content;
                             valStr = p.val ? p.val.toString() : p.content;
                        }

                        let v = parseFloat(valStr.toString().replace(/,/g,'').replace(/[^0-9.]/g, ''));
                        if(isNaN(v)) v = 0;
                        totalValue += v;
                        
                        if(idx === 0) breakdown.funds = v;
                        if(idx === 1) breakdown.stocks = v;
                        if(idx === 2) breakdown.crypto = v;
                        if(idx === 3) breakdown.metal = v;

                        const dataStr = encodeURIComponent(JSON.stringify({title: displayTitle, content: displayVal})); 
                        c.assets.innerHTML += `<div onclick="GardenOS.ui.openDetail('asset', '${dataStr}')" class="asset-compact-item searchable-item cursor-pointer"><div class="precision-tag text-amber-500/50">${displayTitle}</div><div class="text-base font-mono text-white group-hover:text-amber-500 transition-all">${displayVal}</div></div>`;
                    });
                    
                    GardenOS.ui.drawCharts(Math.round(totalValue), breakdown);

                    const defIngest = GardenOS.data.defaultContent.ingest;
                    const defIngestObj = { title: defIngest.title, content: defIngest.content, image: defIngest.image, target: 'ingest' };
                    const defIngestStr = encodeURIComponent(JSON.stringify(defIngestObj));
                    
                    // FIX: Default Ingest Pinned
                    c.ingest.innerHTML = `<div onclick="GardenOS.ui.openDetail('generic', '${defIngestStr}')" class="group flex gap-5 items-start cursor-pointer mb-6 border-b border-white/5 pb-4 last:border-0 searchable-item"><div class="w-14 h-14 bg-white/10 rounded-2xl overflow-hidden flex-shrink-0 border border-white/5"><img src="${defIngest.image}" class="w-full h-full object-cover"></div><div><h4 class="text-sm font-bold group-hover:text-amber-500 transition-colors">${defIngest.title}</h4><p class="text-[10px] text-gray-400 mt-1 line-clamp-2">${defIngest.content}</p></div></div>`;

                    visiblePosts.forEach(p => {
                        const dataStr = encodeURIComponent(JSON.stringify(p));
                        const lockIcon = p.isPrivate ? '<span class="text-[9px] text-amber-500 ml-2">ğŸ”’</span>' : '';
                        
                        if(p.target==='memo') {
                            c.memo.innerHTML += `<div onclick="GardenOS.ui.openDetail('generic', '${dataStr}')" class="group/item bg-white/5 p-6 rounded-[28px] border border-white/5 mb-4 searchable-item cursor-pointer hover:bg-white/10"><div class="flex justify-between items-center mb-3"><div class="flex items-center"><h4 class="text-sm font-bold">${lockIcon}${p.title}</h4></div><span class="text-[9px] text-white/20">${p.timestamp.split(' ')[0]}</span></div><p class="text-xs text-gray-400 line-clamp-2">${p.content}</p></div>`;
                        } else if(p.target==='ingest') {
                            c.ingest.innerHTML += `<div onclick="GardenOS.ui.openDetail('generic', '${dataStr}')" class="group flex gap-5 items-start cursor-pointer mb-6 border-b border-white/5 pb-4 last:border-0 searchable-item"><div class="w-14 h-14 bg-white/10 rounded-2xl overflow-hidden flex-shrink-0 border border-white/5"><img src="${p.image||'https://via.placeholder.com/100'}" class="w-full h-full object-cover"></div><div><div class="flex items-center"><h4 class="text-sm font-bold group-hover:text-amber-500 transition-colors">${lockIcon}${p.title}</h4></div><p class="text-[10px] text-gray-400 mt-1 line-clamp-2">${p.content}</p></div></div>`;
                        }
                    });
                    
                    if(!visiblePosts.some(p => p.target === 'memo')) {
                         c.memo.innerHTML = `<div class="bg-white/5 p-4 rounded-[20px] border border-white/5 opacity-60 text-center"><p class="text-xs text-gray-400 font-serif italic">â€œå²æœˆä¸è¯­ï¼Œå”¯æœ‰æ–‡å­—èƒ½åœ¨å¤§é›ªä¸­å–æš–ã€‚â€</p></div>`;
                    }
                }
            }
        };

        document.addEventListener('DOMContentLoaded', () => GardenOS.boot());
    </script>
</body>
</html>
