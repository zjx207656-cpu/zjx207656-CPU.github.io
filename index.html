<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµå…‰å­˜æ ¹ | Digital Garden</title>
    <!-- å¼•å…¥æ ¸å¿ƒåº“ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;600&family=JetBrains+Mono:wght@200;400&family=Dancing+Script:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0d1017;
            --card-bg: rgba(22, 27, 34, 0.72);
            --accent-color: #e3b341; 
            --text-main: #d1d5db;
            --ambient-glow: rgba(227, 179, 65, 0.05);
        }

        body { 
            background-color: var(--bg-color); 
            color: var(--text-main); 
            font-family: 'Noto Serif SC', serif; 
            margin: 0; padding: 0; 
            overflow-x: hidden; 
            min-height: 100vh;
            transition: background 2s ease;
        }
        
        /* åŠ¨æ€èƒŒæ™¯å›¾å±‚ï¼šèšç„¦åŸå¸‚æš–ç¯ Bokeh é£æ ¼ */
        #dynamicBg { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-size: cover; background-position: center; 
            z-index: -1; filter: brightness(0.4) contrast(1.1);
            transition: background-image 3s ease-in-out;
            background-color: #000;
        }

        .ambient-layer { 
            position: fixed; inset: 0; 
            background: radial-gradient(circle at 50% 50%, var(--ambient-glow) 0%, transparent 70%); 
            pointer-events: none; z-index: 0; 
        }

        /* ç»Ÿä¸€å¡ç‰‡æ ·å¼ï¼šå¤§åœ†è§’ä¸å‘¼å¸æ„Ÿ */
        .bento-card { 
            background: var(--card-bg); backdrop-filter: blur(40px); 
            border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 40px; 
            padding: 2.5rem; transition: all 0.5s cubic-bezier(0.22, 1, 0.36, 1);
            transform-style: preserve-3d;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .bento-card:hover { border-color: var(--accent-color); box-shadow: 0 40px 80px rgba(0,0,0,0.5); transform: translateY(-5px); }

        /* ç½‘æ ¼å¸ƒå±€ï¼šgap-10 ç¡®ä¿ä¸æ‹¥æŒ¤ */
        .bento-grid { 
            display: grid; grid-template-columns: repeat(4, 1fr); 
            grid-auto-rows: minmax(160px, auto); gap: 2.5rem; 
            padding: 0 4rem 6rem 4rem; max-width: 1500px; margin: 0 auto; 
        }

        /* M5 åˆ†ç±»ç³»ç»Ÿ */
        .sensory-menu { display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.8rem; margin-top: 1.5rem; }
        .sensory-btn { aspect-ratio: 1; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05); border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.3s; cursor: pointer; }
        .sensory-btn:hover { background: var(--ambient-glow); border-color: var(--accent-color); transform: scale(1.05); }
        .sensory-btn span { font-size: 9px; margin-top: 8px; opacity: 0.3; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-main); }

        .sensory-detail-view { position: absolute; inset: 0; background: #0d1017; z-index: 100; border-radius: 40px; padding: 2.5rem; display: none; flex-direction: column; }
        .sensory-detail-view.active { display: flex; }

        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; border: 2px solid rgba(255,255,255,0.1); }
        .status-online { background: #85a583; box-shadow: 0 0 15px #85a583; }

        .mono { font-family: 'JetBrains Mono', monospace; }
        .serif { font-family: 'Noto Serif SC', serif; }
        .module-time { font-family: 'JetBrains Mono', monospace; font-size: 10px; opacity: 0.2; letter-spacing: 0.1em; }

        /* å‘å¸ƒé¢æ¿ */
        #adminPostArea { transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1); max-height: 0; overflow: hidden; opacity: 0; }
        #adminPostArea.active { max-height: 1200px; opacity: 1; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1); }
        .hint-box { background: rgba(227, 179, 65, 0.05); border-left: 3px solid var(--amber-gold); padding: 1rem; border-radius: 0 12px 12px 0; margin-bottom: 1.5rem; }
        .custom-select { background: #1a1d23; color: #888; border: 1px solid rgba(255,255,255,0.1); padding: 0.7rem 1rem; border-radius: 14px; outline: none; width: 100%; font-size: 11px; }

        #historyDrawer { position: fixed; right: -550px; top: 0; width: 500px; height: 100vh; background: rgba(13, 16, 23, 0.98); backdrop-filter: blur(40px); z-index: 8000; transition: 0.6s cubic-bezier(0.22, 1, 0.36, 1); border-left: 1px solid rgba(255, 255, 255, 0.1); padding: 3rem; overflow-y: auto; }
        #historyDrawer.open { right: 0; }

        .sound-wave { display: flex; gap: 3px; height: 14px; align-items: flex-end; }
        .wave-bar { width: 2px; background: var(--accent-color); animation: wave 1s infinite ease-in-out; }
        @keyframes wave { 0%, 100% { height: 4px; } 50% { height: 14px; } }
        .sound-off .wave-bar { animation: none; height: 2px !important; opacity: 0.2; }

        #imageLightbox { position: fixed; inset: 0; background: rgba(0,0,0,0.92); backdrop-filter: blur(30px); z-index: 15000; display: none; align-items: center; justify-content: center; cursor: zoom-out; }
        #imageLightbox img { max-width: 85%; max-height: 85%; border-radius: 12px; box-shadow: 0 0 80px rgba(0,0,0,1); }
        #imageLightbox.active { display: flex; }
    </style>
</head>
<body>

    <div id="dynamicBg"></div>
    <div class="ambient-layer"></div>
    <div id="imageLightbox" onclick="this.classList.remove('active')"><img id="lightboxImg" src=""></div>

    <!-- ç®¡ç†éªŒè¯ -->
    <div id="loginModal" style="display:none;">
        <div class="bg-[#161a22] p-12 rounded-[56px] border border-white/10 w-full max-w-sm text-center shadow-3xl">
            <h3 class="mono text-[11px] uppercase tracking-[0.5em] opacity-30 mb-8 font-bold text-white text-center">Master Identification</h3>
            <input type="password" id="secretKeyInput" class="w-full bg-white/5 border border-white/10 rounded-2xl p-5 text-center mono tracking-widest focus:outline-none focus:border-amber-500/50 transition-colors mb-8 text-white" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            <div class="flex gap-4">
                <button onclick="document.getElementById('loginModal').style.display='none'" class="flex-1 py-4 text-[10px] mono opacity-30 hover:opacity-100 transition-opacity uppercase font-bold">Cancel</button>
                <button id="confirmLogin" class="flex-1 py-4 bg-white/5 hover:bg-white hover:text-black rounded-xl text-[10px] mono transition-all font-bold uppercase tracking-widest">Verify</button>
            </div>
        </div>
    </div>

    <!-- åˆå¹¶åçš„æç®€åç‰‡é¢æ¿ -->
    <div id="contactPanel" style="position: fixed; top: 110px; right: 40px; width: 300px; background: rgba(30, 34, 42, 0.98); backdrop-filter: blur(45px); border: 1px solid rgba(255, 255, 255, 0.12); border-radius: 32px; padding: 2.5rem; z-index: 9000; box-shadow: 0 30px 60px rgba(0,0,0,0.7); display: none; transform: translateY(-20px); opacity: 0; transition: all 0.5s cubic-bezier(0.22, 1, 0.36, 1);">
        <div class="flex justify-between items-center mb-8"><span class="mono text-[10px] opacity-40 uppercase font-bold tracking-[0.3em] w-full text-center">Connectivity</span><button onclick="document.getElementById('contactPanel').style.display='none'; document.getElementById('contactPanel').style.opacity='0';" class="text-white/20 hover:text-white p-2">âœ•</button></div>
        <div class="space-y-8">
            <div class="group"><div class="text-[9px] opacity-20 mono mb-2 uppercase tracking-tighter text-center">Mailbox</div><div class="flex justify-between items-center bg-white/[0.02] p-4 rounded-2xl border border-white/5"><span class="text-xs mono text-center w-full">zjx207656@gmail.com</span><button onclick="copyToClipboard('zjx207656@gmail.com')" class="px-3 py-1.5 bg-white/5 rounded-lg text-[9px] mono text-amber-500">COPY</button></div></div>
            <div class="group"><div class="text-[9px] opacity-20 mono mb-2 uppercase tracking-tighter text-center">WeChat ID</div><div class="flex justify-between items-center bg-white/[0.02] p-4 rounded-2xl border border-white/5"><span class="text-xs mono text-center w-full">Zj_6174</span><button onclick="copyToClipboard('Zj_6174')" class="px-3 py-1.5 bg-white/5 rounded-lg text-[9px] mono text-amber-500">COPY</button></div></div>
        </div>
    </div>

    <div class="content-wrapper">
        <div class="container mx-auto max-w-[1600px] pt-12 pb-24">
            
            <!-- æç®€é¡µçœ‰ï¼šå›¾æ ‡åŠŸèƒ½ç»„é›†æˆ -->
            <header class="mb-16 lg:px-16 flex flex-col lg:flex-row justify-between items-center gap-8 text-center lg:text-left">
                <div>
                    <h1 id="siteTitle" class="text-7xl font-bold text-white mb-2 tracking-tighter font-serif transition-colors duration-1000">æµå…‰å­˜æ ¹</h1>
                    <p class="text-xl text-gray-500 font-light italic serif">å…·ä½“çš„ç”Ÿæ´»ï¼Œæ˜¯æŠµå¾¡è™šæ— çš„æœ€åä¸€é“é˜²çº¿ã€‚</p>
                </div>
                <div class="flex flex-col items-center lg:items-end gap-6">
                    <div class="flex items-center gap-10">
                        <div class="visitor-stat flex items-center">
                            <div id="syncIndicator" class="status-dot status-offline" onclick="window.emergencySync()"></div>
                            <span id="visitorCount" class="font-bold tracking-[0.2em] text-white/40 ml-3 text-xs">----</span>
                        </div>
                        <button id="soundToggle" class="flex items-center gap-3 group sound-off">
                            <div class="sound-wave"><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div></div>
                            <span class="mono text-[9px] opacity-20 group-hover:opacity-60 uppercase tracking-widest">Atmosphere</span>
                        </button>
                        <div id="liveClock" class="mono text-xs text-amber-500/50 tracking-[0.3em]">00:00:00</div>
                    </div>
                    <!-- æ ¸å¿ƒå›¾æ ‡ç»„ -->
                    <div class="flex items-center gap-5">
                        <button id="searchTrigger" class="text-gray-500 hover:text-white transition-all p-3 rounded-full hover:bg-white/5" title="Search"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                        <!-- è”ç³»æ–¹å¼åˆä¸€å›¾æ ‡ -->
                        <button onclick="toggleContactPanel()" class="text-gray-500 hover:text-amber-500 transition-colors p-3 rounded-full hover:bg-white/5" title="Contact"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg></button>
                        <button id="adminLockTrigger" class="text-gray-500 hover:text-white transition-colors p-3 rounded-full hover:bg-white/5" title="Master Lock"><svg id="lockIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></button>
                    </div>
                </div>
            </header>

            <div class="bento-grid">
                <!-- M1 -->
                <div class="bento-card col-span-2 row-span-2 flex flex-col justify-between overflow-hidden">
                    <div class="relative z-10">
                        <div class="flex items-center gap-3 mb-10"><div id="pulseDot" class="w-2 h-2 rounded-full bg-[#85a583] shadow-[0_0_20px_#85a583]"></div><span class="mono text-[10px] uppercase tracking-[0.2em] opacity-40">System Pulse: <span id="lastUpdatedGlobal">Live</span></span></div>
                        <h2 class="text-4xl font-bold text-white mb-14 tracking-tight">ç”Ÿæ´»åˆ»åº¦</h2>
                        <div class="space-y-12">
                            <div>
                                <div class="flex justify-between items-baseline mb-5"><span class="text-gray-400 text-[10px] tracking-widest uppercase font-light opacity-60">Creative Pulse</span><span id="versionLabel" class="module-time font-bold opacity-80 text-amber-500">v7.2.0_STABLE</span></div>
                                <div class="h-[2px] w-full bg-white/10 rounded-full overflow-hidden"><div id="progressFill" class="h-full bg-white/70 shadow-[0_0_15px_white]" style="width: 82%"></div></div>
                                <p class="text-xl mt-12 italic text-gray-400 serif leading-relaxed">â€œåœ¨é‡åŒ–çš„åæ ‡ä¸­ï¼Œæ„ŸçŸ¥æ—¶é—´çš„åšåº¦ã€‚â€</p>
                            </div>
                        </div>
                    </div>
                    <div class="pt-12 border-t border-white/5 flex gap-20 relative z-10">
                        <div><div class="text-4xl font-light text-white mono"><span id="weightVal">55.0</span><span class="text-xs opacity-20 ml-2">KG</span></div><div class="text-[9px] mono opacity-30 mt-3 uppercase tracking-[0.2em]">Weight</div></div>
                        <div><div class="text-4xl font-light text-white mono"><span id="speedVal">95</span><span class="text-xs opacity-20 ml-2">%</span></div><div class="text-[9px] mono opacity-30 mt-3 uppercase tracking-[0.2em]">Creativity</div></div>
                    </div>
                </div>

                <!-- M3 -->
                <div class="bento-card col-span-2">
                    <div class="flex justify-between items-center mb-12"><h3 class="mono text-[11px] opacity-40 uppercase tracking-[0.4em]">// Ingesting_Feed</h3><span id="m3Time" class="module-time uppercase">Dec 19</span></div>
                    <div id="ingestList" class="space-y-10 flex-grow">
                        <div class="flex gap-6 items-start group">
                            <img src="https://images.unsplash.com/photo-1544947950-fa07a98d237f?q=80&w=200&auto=format&fit=crop" class="w-14 h-14 object-cover rounded-2xl border border-white/5 cursor-zoom-in" onclick="openLightbox(this.src)">
                            <div class="flex-grow"><div class="flex justify-between items-start mb-1"><span class="text-sm font-semibold text-gray-200">ã€ŠçŒ®ç»™é˜¿å°”å‰ä¾¬çš„èŠ±æŸã€‹</span><span class="module-time">Reading</span></div><p class="text-xs text-gray-500 italic line-clamp-2 leading-relaxed">å…³äºæ™ºæ…§ä¸å­¤ç‹¬æœ€æ®‹å¿çš„å¯“è¨€ã€‚</p></div>
                        </div>
                        <div class="flex gap-6 items-start group">
                            <img src="https://images.unsplash.com/photo-1579621970563-ebec7560ff3e?q=80&w=200&auto=format&fit=crop" class="w-14 h-14 object-cover rounded-2xl border border-white/5 cursor-zoom-in" onclick="openLightbox(this.src)">
                            <div class="flex-grow"><div class="flex justify-between items-start mb-1"><span class="text-sm font-semibold text-gray-200">ã€Šé‡‘é’±å¿ƒç†å­¦ã€‹</span><span class="module-time">Study</span></div><p class="text-xs text-gray-500 italic line-clamp-2 leading-relaxed">ç†è§£è´¢å¯Œï¼Œæœ¬è´¨ä¸Šæ˜¯ç†è§£äººæ€§çš„å¼±ç‚¹ã€‚</p></div>
                        </div>
                    </div>
                </div>

                <!-- M7 -->
                <div id="musingModule" class="bento-card col-span-2 row-span-2 flex flex-col relative overflow-hidden">
                    <div class="flex justify-between items-start mb-10"><span class="mono text-[10px] opacity-30 uppercase tracking-[0.5em]">é›¶æ•£å›å“ / Echoes</span></div>
                    <div id="musingContent" class="flex-grow flex flex-col justify-center">
                        <div id="latestEcho" class="relative p-12 bg-white/[0.01] border-l-2 border-amber-500/20 rounded-r-[40px]">
                            <p id="echoText" class="text-2xl leading-relaxed text-gray-300 font-light italic serif">â€œæ¯ä¸€æ®µè¢«å†™ä¸‹çš„æ–‡å­—ï¼Œéƒ½æ˜¯å¯¹æµé€å²æœˆçš„æ¸©æŸ”å­˜æ ¹ã€‚â€</p>
                            <div id="latestEchoImgContainer"></div>
                        </div>
                    </div>
                    <div id="adminPostArea" class="space-y-6">
                        <div id="publishGuide" class="hint-box"><p id="guideText" class="text-[11px] text-gray-400 italic">é€‰æ‹©åˆ†ç±»ä»¥è·å–å‘å¸ƒå»ºè®®...</p></div>
                        <div class="grid grid-cols-2 gap-5">
                            <select id="postType" class="custom-select" onchange="updateGuide(this.value)"><option value="echo">CATEGORY: ECHO</option><option value="learning">CATEGORY: LEARNING</option><option value="entertainment">CATEGORY: ENTERTAIN</option><option value="article">CATEGORY: ARTICLE</option><option value="metrics">CATEGORY: METRICS</option></select>
                            <input type="text" id="postTitle" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm text-white outline-none" placeholder="Title">
                        </div>
                        <input type="text" id="postImageUrl" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-[10px] mono text-white" placeholder="Media Link (URL)">
                        <textarea id="newEchoInput" class="w-full bg-white/5 border border-white/10 rounded-2xl p-5 text-sm font-light text-white outline-none" placeholder="Content..." rows="3"></textarea>
                        <div class="flex justify-between items-center pt-2"><label class="flex items-center gap-3 cursor-pointer opacity-30 hover:opacity-100 transition-opacity"><input type="checkbox" id="isPrivateEntry" class="w-4 h-4 accent-amber-500"><span class="text-[10px] mono uppercase text-white tracking-widest font-bold">Privacy</span></label><button id="postEchoBtn" class="px-10 py-4 bg-white/5 hover:bg-white hover:text-black rounded-2xl text-[10px] mono transition-all font-bold text-white uppercase tracking-[0.5em] shadow-xl">STAMP</button></div>
                    </div>
                </div>

                <!-- M2 -->
                <div id="narrativeCard" class="bento-card col-span-2 cursor-pointer group">
                    <div class="default-content">
                        <div class="flex justify-between items-center mb-10"><span class="mono text-[10px] opacity-30 uppercase tracking-[0.5em]">ä¹¦å†™æ¡£æ¡ˆ / Narrative</span><span class="module-time text-amber-500/60 font-bold tracking-widest">Active</span></div>
                        <p class="text-3xl leading-relaxed text-gray-300 font-light italic serif group-hover:text-amber-500/90 transition-colors">â€œä¹¦å†™ï¼Œæ˜¯ä¸è‡ªæˆ‘çš„æ·±åº¦åšå¼ˆã€‚â€</p>
                        <p class="text-[10px] mt-10 mono opacity-20 uppercase tracking-[0.2em]">Click to browse archives</p>
                    </div>
                    <div id="articleListView" class="article-list hidden pt-4">
                        <div id="dynamicArticleList" class="grid grid-cols-1 gap-10">
                            <div class="flex justify-between items-center border-b border-white/5 pb-6 group/item">
                                <div class="flex flex-col">
                                    <a href="https://www.notion.so/Tongchuan-Past-Snippet" target="_blank" class="text-base text-gray-200 group-hover/item:text-amber-500 transition-colors font-serif italic">é“œå·å¾€äº‹ï¼šé‚£äº›è¢«é—å¿˜çš„æ—¶é—´ç¢ç‰‡</a>
                                    <span class="text-[10px] text-gray-500 mt-2">åœ¨ç…¤çƒŸä¸é»„åœŸä¹‹é—´ï¼Œå¯»æ‰¾ä¸€ä»£äººçš„ç²¾ç¥æ¥å¤„ã€‚</span>
                                </div>
                                <span class="mono text-[9px] opacity-20 uppercase font-bold">Notion</span>
                            </div>
                        </div>
                        <button id="closeArchive" class="text-[10px] mono opacity-20 hover:opacity-100 uppercase mt-12 tracking-[0.5em] font-bold">[ Return ]</button>
                    </div>
                </div>

                <!-- M5 -->
                <div id="sensoryCard" class="bento-card col-span-2 relative overflow-hidden">
                    <div id="sensoryMain">
                        <div class="flex justify-between items-center mb-10"><h3 class="mono text-[11px] opacity-40 uppercase tracking-[0.6em]">// Sensory_Memory</h3><span id="m5Time" class="module-time uppercase text-amber-500/50 font-bold">Five Clusters</span></div>
                        <div class="sensory-menu">
                            <div class="sensory-btn" onclick="openSensoryCategory('åŠ¨æ¼«')">ğŸ•<span>åŠ¨æ¼«</span></div>
                            <div class="sensory-btn" onclick="openSensoryCategory('æ¸¸æˆ')">ğŸ®<span>æ¸¸æˆ</span></div>
                            <div class="sensory-btn" onclick="openSensoryCategory('ç”µå½±')">ğŸ¬<span>ç”µå½±</span></div>
                            <div class="sensory-btn" onclick="openSensoryCategory('é£æ™¯')">ğŸŒ²<span>é£æ™¯</span></div>
                            <div class="sensory-btn" onclick="openSensoryCategory('éŸ³ä¹')">ğŸ“»<span>éŸ³ä¹</span></div>
                        </div>
                    </div>
                    <div id="sensoryDetail" class="sensory-detail-view">
                        <div class="flex justify-between items-center">
                            <h4 id="categoryTitle" class="mono text-[10px] text-amber-500 font-bold tracking-[0.4em] uppercase">Category</h4>
                            <button onclick="closeSensoryCategory()" class="text-white/20 hover:text-white mono text-[10px] font-bold">[ BACK ]</button>
                        </div>
                        <div id="categoryContent" class="sensory-list"></div>
                    </div>
                </div>

                <!-- M6 -->
                <div id="investCard" class="bento-card col-span-4 min-h-[420px]">
                    <div class="flex justify-between items-start mb-12"><h3 class="mono text-[11px] opacity-40 uppercase tracking-[0.8em]">Wealth Pulse Monitor</h3><span id="m6Time" class="module-time uppercase font-bold text-amber-500/60 tracking-widest">DeepSeek Sync</span></div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-20 flex-grow items-center">
                        <div class="lg:col-span-1 space-y-10"><div class="flex flex-col gap-5"><div class="invest-tab active" data-type="fund">åŸºé‡‘ (Fund)</div><div class="invest-tab" data-type="stock">è‚¡ç¥¨ (Stock)</div><div class="invest-tab" data-type="crypto">æ•°å­—å¸ (Crypto)</div><div class="invest-tab" data-type="metal">è´µé‡‘å± (Metal)</div></div><div id="investText" class="text-sm font-light text-gray-400 leading-relaxed italic border-l-2 border-white/5 pl-8 pt-2">ä¿æŒç¨³å¥çš„ç°é‡‘æµï¼Œæ˜¯é•¿æœŸä¸»ä¹‰çš„åŸºç¡€ã€‚</div></div>
                        <div class="lg:col-span-1 flex flex-col justify-center"><svg class="mini-chart" viewBox="0 0 400 100"><defs><linearGradient id="chartGradient" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="var(--accent-color)" stop-opacity="0.3"/><stop offset="100%" stop-color="var(--accent-color)" stop-opacity="0"/></linearGradient></defs><path id="trendArea" d="" fill="url(#chartGradient)"></path><path id="trendPath" d="M 0 100 L 400 100" fill="none" stroke="var(--accent-color)" stroke-width="4" stroke-linecap="round"></path></svg></div>
                        <div class="lg:col-span-1 flex flex-col items-center justify-center border-l border-white/5"><div class="relative"><svg class="donut-chart" viewBox="0 0 40 40" class="w-32 h-32"><circle class="donut-ring" cx="20" cy="20" r="15.9" stroke="rgba(255,255,255,0.02)"></circle><circle id="donutSegment" class="donut-ring" cx="20" cy="20" r="15.9" stroke="var(--accent-color)" stroke-dasharray="25 100"></circle></svg><div class="absolute inset-0 flex flex-col items-center justify-center"><span id="donutPercent" class="mono text-2xl font-bold text-white tracking-tighter">25%</span></div></div></div>
                    </div>
                </div>

                <div class="bento-card col-span-4 bg-white/[0.01] flex flex-col justify-center items-center opacity-10 py-16"><span class="mono text-3xl font-light tracking-[2.5em] text-white uppercase ml-[2.5em]">Archives_Core_Online</span></div>
            </div>
        </div>
    </div>

    <!-- ä¾§è¾¹æ  -->
    <aside id="historyDrawer">
        <div class="flex justify-between items-center mb-16"><h2 class="text-3xl font-bold text-white tracking-tight font-serif">æ—¶é—´è½´æ£€ç´¢</h2><button id="closeHistory" class="text-gray-500 hover:text-white font-bold text-3xl">âœ•</button></div>
        <div class="mb-14 p-10 bg-white/[0.03] border border-white/10 rounded-[44px]">
            <h3 class="mono text-[10px] uppercase tracking-[0.5em] opacity-40 mb-8 font-bold tracking-widest text-amber-500 text-center">Guardian AI</h3>
            <div id="guardianMsg" class="guardian-msg bg-white/[0.05] p-8 rounded-3xl text-sm leading-relaxed mb-8 border-l-2 border-amber-500 hidden text-white/80"></div>
            <input type="text" id="aiChatInput" class="w-full bg-white/5 border border-white/10 rounded-2xl p-5 text-sm outline-none focus:border-amber-500/30 text-white font-light" placeholder="æé—®æˆ‘çš„å†å²...">
            <button id="askGuardianBtn" class="w-full mt-6 text-[11px] mono text-amber-500/70 hover:text-amber-500 transition-all font-bold uppercase py-4 border border-amber-500/20 rounded-2xl hover:bg-amber-500/10">æ´¾é£æŒ‡ä»¤ (Query)</button>
        </div>
        <input type="text" id="globalSearch" class="w-full bg-white/5 border border-white/10 rounded-2xl p-7 text-sm mb-12 text-white focus:outline-none" placeholder="æœç´¢å…³é”®è¯è®°å½•...">
        <div id="historyTimeline" class="space-y-16"></div>
    </aside>

    <audio id="ambientAudio" loop preload="auto"><source src="https://www.soundjay.com/nature/sounds/fireplace-1.mp3" type="audio/mpeg"></audio>

    <!-- 1. UI æ ¸å¿ƒè„šæœ¬ï¼šç¯å¢ƒå¼•æ“ä¸äº¤äº’ -->
    <script>
        const ADMIN_SECRET = "Zjx207661";
        window.HARDCODED_DEEPSEEK_KEY = "sk-437d432e53664e489b60a9349619a879"; 

        // åŠ¨æ€ç¯å¢ƒï¼šåŸå¸‚æš–ç¯é€»è¾‘
        const CONFIG = {
            seasons: {
                spring: { theme: '#85a583', query: 'city,night,street,bokeh,lights' },
                summer: { theme: '#4a90e2', query: 'urban,sunset,bokeh,warm' },
                autumn: { theme: '#e3b341', query: 'city,rain,night,bokeh,amber' },
                winter: { theme: '#8b86a3', query: 'city,night,snow,bokeh,lights' }
            },
            times: {
                dawn: { opacity: 0.5, brightness: 0.55 },
                noon: { opacity: 0.3, brightness: 0.65 },
                dusk: { opacity: 0.65, brightness: 0.45 },
                night: { opacity: 0.9, brightness: 0.38 }
            }
        };

        function updateEnvironment() {
            const now = new Date();
            const month = now.getMonth() + 1;
            const hour = now.getHours();
            
            let season = 'winter';
            if (month >= 3 && month <= 5) season = 'spring';
            else if (month >= 6 && month <= 8) season = 'summer';
            else if (month >= 9 && month <= 11) season = 'autumn';
            
            let timeKey = 'night';
            if (hour >= 5 && hour < 9) timeKey = 'dawn';
            else if (hour >= 9 && hour < 17) timeKey = 'noon';
            else if (hour >= 17 && hour < 20) timeKey = 'dusk';

            const sConf = CONFIG.seasons[season];
            const tConf = CONFIG.times[timeKey];

            document.documentElement.style.setProperty('--accent-color', sConf.theme);
            document.getElementById('siteTitle').style.color = sConf.theme;
            // é‡‡ç”¨æ›´ç¨³å®šçš„ Featured Image æ¥å£
            const bgUrl = `https://images.unsplash.com/photo-1514565131-fce0801e5785?q=80&w=1600&auto=format&fit=crop`; // åŸºç¡€æš–ç¯å›¾ä½œä¸ºå…œåº•
            document.getElementById('dynamicBg').style.backgroundImage = `linear-gradient(rgba(13,16,22,${tConf.opacity}), rgba(13,16,22,${tConf.opacity+0.05})), url('https://images.unsplash.com/featured/1600x900/?${sConf.query}')`;
            document.getElementById('dynamicBg').style.filter = `brightness(${tConf.brightness}) contrast(1.1)`;
        }
        updateEnvironment();

        // ç¦»çº¿æ•°æ®
        window._allLogs = [
            { type: 'entertainment', title: 'åŠ¨æ¼«', text: 'EVA: å°‘å¹´æˆä¸ºç¥è¯ã€‚', imageUrl: 'https://images.unsplash.com/photo-1578632738980-23055e396656?q=80&w=600', createdAt: {seconds: Date.now()/1000} },
            { type: 'entertainment', title: 'ç”µå½±', text: 'é“¶ç¿¼æ€æ‰‹: èµ›åšä¹‹å…‰ã€‚', imageUrl: 'https://images.unsplash.com/photo-1605806616949-1e87b487fc2f?q=80&w=600', createdAt: {seconds: Date.now()/1000-100} }
        ];

        // äº¤äº’é€»è¾‘
        window.toggleContactPanel = () => {
            const panel = document.getElementById('contactPanel');
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
                setTimeout(() => { panel.style.opacity = '1'; panel.style.transform = 'translateY(0)'; }, 10);
            } else {
                panel.style.opacity = '0'; panel.style.transform = 'translateY(-20px)';
                setTimeout(() => { panel.style.display = 'none'; }, 500);
            }
        };

        const GUIDE_DICT = {
            "echo": "å·¦ä¾§éšç¬”ã€‚å†…å®¹æ–‡å­—ï¼Œå›¾ç‰‡å¯é€‰ã€‚",
            "learning": "ä¸Šæ–¹æ‘„å…¥æµã€‚æ ‡é¢˜å¡«åå­—ï¼Œå†…å®¹çŸ­è¯„ã€‚",
            "entertainment": "æ ‡é¢˜å¿…å¡« [åŠ¨æ¼«/æ¸¸æˆ/ç”µå½±/é£æ™¯/éŸ³ä¹] ä¹‹ä¸€ã€‚",
            "article": "ä¹¦å†™æ¡£æ¡ˆåˆ—è¡¨ã€‚å†…å®¹å¡«é“¾æ¥ã€‚",
            "metrics": "æ›´æ–°æŒ‡æ ‡ã€‚æ ¼å¼ï¼šä½“é‡,åˆ›æ„å€¼ (ä¾‹ 55.0,95)ã€‚"
        };
        window.updateGuide = (val) => { document.getElementById('guideText').innerText = GUIDE_DICT[val] || GUIDE_DICT["echo"]; };
        setInterval(() => { const el = document.getElementById('liveClock'); if(el) el.innerText = new Date().toLocaleTimeString(); }, 1000);

        document.getElementById('adminLockTrigger').onclick = () => {
            if (localStorage.getItem('is_garden_admin') === 'true') {
                localStorage.removeItem('is_garden_admin'); window.isAdmin = false;
                document.getElementById('lockIcon').classList.remove('text-amber-500');
                document.getElementById('adminPostArea').classList.remove('active');
                alert("ç®¡ç†å‘˜æ³¨é”€ã€‚");
            } else { document.getElementById('loginModal').style.display = 'flex'; document.getElementById('secretKeyInput').focus(); }
        };

        document.getElementById('confirmLogin').onclick = () => {
            if (document.getElementById('secretKeyInput').value === ADMIN_SECRET) {
                localStorage.setItem('is_garden_admin', 'true'); window.isAdmin = true;
                document.getElementById('loginModal').style.display = 'none';
                if(window.updateAdminUI) window.updateAdminUI();
                alert("éªŒè¯æˆåŠŸã€‚"); updateGuide("echo");
            } else { alert("éªŒè¯å¤±è´¥ã€‚"); }
        };

        window.openSensoryCategory = (cat) => {
            document.getElementById('categoryTitle').innerText = `Sensory // ${cat}`;
            const listEl = document.getElementById('categoryContent');
            const data = (window._allLogs || []).filter(l => l.type === 'entertainment' && l.title === cat).sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
            listEl.innerHTML = data.length === 0 ? `<div class='col-span-2 text-center py-20 opacity-10 mono text-xs'>[ NO STUBS ]</div>` : 
                data.map(item => `<div class="bg-white/5 p-6 rounded-3xl border border-white/5 animate-fade-in"><img src="${item.imageUrl}" class="w-full h-40 object-cover rounded-2xl mb-4 cursor-zoom-in" onclick="openLightbox(this.src)"><p class="text-xs text-gray-400 font-light leading-relaxed">${item.text}</p></div>`).join('');
            document.getElementById('sensoryDetail').classList.add('active');
        };
        window.closeSensoryCategory = () => document.getElementById('sensoryDetail').classList.remove('active');
        window.openLightbox = (url) => { const box = document.getElementById('imageLightbox'); const img = document.getElementById('lightboxImg'); if(box && img) { img.src = url; box.classList.add('active'); } };
        window.copyToClipboard = (t) => { const el = document.createElement('textarea'); el.value = t; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el); alert("å·²å­˜å…¥å‰ªè´´æ¿ã€‚"); };

        const audio = document.getElementById('ambientAudio');
        const sBtn = document.getElementById('soundToggle');
        if(sBtn) sBtn.onclick = () => { if (audio.paused) { audio.play().then(() => { sBtn.classList.remove('sound-off'); }).catch(() => { alert("è¯·ç‚¹å‡»é¡µé¢ä»»æ„å¤„æ¿€æ´»éŸ³ä¹ã€‚"); }); } else { audio.pause(); sBtn.classList.add('sound-off'); } };

        document.getElementById('askGuardianBtn').onclick = async () => {
            const box = document.getElementById('guardianMsg'); const input = document.getElementById('aiChatInput');
            const question = input.value.trim(); if(!question) return;
            const btn = document.getElementById('askGuardianBtn'); btn.innerText = "Thinking..."; btn.disabled = true;
            box.classList.remove('hidden'); box.innerText = "æ­£åœ¨æ„ŸçŸ¥å†å²å›å“...";
            try {
                const res = await fetch("https://api.deepseek.com/chat/completions", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${window.HARDCODED_DEEPSEEK_KEY}` },
                    body: JSON.stringify({ model: "deepseek-chat", messages: [{ role: "system", content: "ä½ æ˜¯æ¡£æ¡ˆå®ˆæœ›è€…ã€‚è¯·æ ¹æ®å†å²è®°å½•å¹¶ç”¨è¯—æ„ç®€æ´ã€ç†æ€§çš„è¯­æ°”å›ç­”æé—®ã€‚" }, { role: "user", content: `æé—®ï¼š${question}` }] })
                });
                const data = await res.json(); box.innerText = data.choices[0].message.content;
            } catch(e) { box.innerText = "å›å“æ–­è£‚ã€‚"; } finally { btn.innerText = "æ´¾é£æŒ‡ä»¤ (Query)"; btn.disabled = false; input.value = ""; }
        };

        window.emergencySync = () => { window.location.reload(); };
        document.getElementById('searchTrigger').onclick = () => document.getElementById('historyDrawer').classList.add('open');
        document.getElementById('closeHistory').onclick = () => document.getElementById('historyDrawer').classList.remove('open');
    </script>

    <!-- 2. Firebase åŒæ­¥é€»è¾‘ (é™é»˜è¿è¡Œ) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, addDoc, deleteDoc, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let db, auth, appId;
        window.isAdmin = localStorage.getItem('is_garden_admin') === 'true';

        async function startSystem() {
            const indicator = document.getElementById('syncIndicator');
            if(indicator) indicator.className = "status-dot status-pending";
            try {
                const configStr = typeof __firebase_config !== 'undefined' ? __firebase_config : null;
                if(!configStr) return;
                const app = initializeApp(JSON.parse(configStr));
                auth = getAuth(app); db = getFirestore(app); appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                await (typeof __initial_auth_token !== 'undefined' && __initial_auth_token ? signInWithCustomToken(auth, __initial_auth_token) : signInAnonymously(auth));
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        window.currentUser = user;
                        if(indicator) indicator.className = "status-dot status-online";
                        const vDoc = doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'visitors');
                        await setDoc(vDoc, { count: increment(1) }, { merge: true }).catch(()=>{});
                        onSnapshot(vDoc, s => { if(s.exists()) document.getElementById('visitorCount').innerText = s.data().count.toLocaleString(); }, ()=>{});
                        window.updateAdminUI(); loadData();
                    }
                });
            } catch (e) { if(indicator) indicator.className = "status-dot status-offline"; }
        }

        function loadData() {
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'logs'), s => { window._publicLogs = s.docs.map(d => ({ id: d.id, ...d.data(), isPrivate: false })); finalize(); }, ()=>{});
            onSnapshot(collection(db, 'artifacts', appId, 'users', window.currentUser.uid, 'private_logs'), s => { window._privateLogs = s.docs.map(d => ({ id: d.id, ...d.data(), isPrivate: true })); finalize(); }, ()=>{});
            onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'global'), s => {
                const d = s.data() || {};
                const m = { weightVal:'weight', speedVal:'speed' };
                Object.keys(m).forEach(k => { if(document.getElementById(k)) document.getElementById(k).innerText = d[m[k]] || (k === 'weightVal' ? '55.0' : '95'); });
            }, ()=>{});
        }

        function finalize() {
            const all = [...(window._publicLogs || []), ...(window._privateLogs || [])].sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
            window._allLogs = all; window.refreshDisplay(); renderTimeline(all);
            if(all[0] && all[0].createdAt) document.getElementById('lastUpdatedGlobal').innerText = new Date(all[0].createdAt.seconds*1000).toLocaleTimeString();
        }

        window.refreshDisplay = () => {
            const all = window._allLogs || []; if(all.length === 0) return;
            const latestEcho = window.isAdmin ? all.filter(l => l.type==='echo')[0] : all.filter(l => l.type==='echo' && !l.isPrivate)[0];
            if (latestEcho) {
                document.getElementById('echoText').innerText = latestEcho.text;
                document.getElementById('latestEchoImgContainer').innerHTML = latestEcho.imageUrl ? `<img src="${latestEcho.imageUrl}" class="record-image shadow-2xl" onclick="window.openLightbox('${latestEcho.imageUrl}')">` : '';
            }
            const iEl = document.getElementById('ingestList');
            const ingests = all.filter(l => l.type === 'learning').slice(0, 3);
            if(ingests.length > 0) iEl.innerHTML = ingests.map(i => `<div class="flex gap-6 items-start animate-fade-in"><img src="${i.imageUrl}" class="w-14 h-14 object-cover rounded-xl border border-white/5 cursor-zoom-in" onclick="window.openLightbox('${i.imageUrl}')"><div class="flex-grow"><div class="flex justify-between items-start mb-1"><span class="text-sm font-semibold text-gray-200">${i.title}</span></div><p class="text-[12px] text-gray-500 italic line-clamp-1 opacity-80">${i.text}</p></div></div>`).join('');
            const arts = all.filter(l => l.type === 'article');
            if(arts.length > 0) document.getElementById('dynamicArticleList').innerHTML = arts.map(a => `<div class="flex justify-between items-center border-b border-white/5 pb-6 group/item"><div class="flex flex-col"><a href="${a.text}" target="_blank" class="text-base text-gray-300 group-hover/item:text-amber-500 transition-colors font-serif italic">${a.title}</a></div><span class="mono text-[9px] opacity-20 uppercase font-bold">Archive</span></div>`).join('');
        };

        window.updateAdminUI = () => { if (window.isAdmin) { document.getElementById('adminPostArea').classList.add('active'); document.getElementById('lockIcon').classList.add('text-amber-500'); } };
        function renderTimeline(data) {
            const container = document.getElementById('historyTimeline'); if(!container) return;
            const q = document.getElementById('globalSearch').value.toLowerCase();
            const filtered = data.filter(l => (window.isAdmin || !l.isPrivate) && (l.text?.toLowerCase().includes(q) || l.title?.toLowerCase().includes(q)));
            container.innerHTML = filtered.map(l => `<div class="pl-16 relative group mb-16"><div class="absolute left-0 top-3 w-8 h-8 rounded-full border-4 border-[#0d1017] ${l.isPrivate ? 'bg-amber-600' : 'bg-[#85a583]'} shadow-xl"></div><div class="flex justify-between items-center mb-3"><span class="mono text-[10px] opacity-30 font-bold">${l.createdAt ? new Date(l.createdAt.seconds * 1000).toLocaleString() : ''}</span>${isAdmin ? `<button onclick="window.deleteLog('${l.id}', ${l.isPrivate})" class="text-[10px] opacity-0 group-hover:opacity-40 hover:text-red-500 transition-all font-bold uppercase tracking-widest">[ Purge ]</button>` : ''}</div><h4 class="text-white font-bold text-base mb-3 uppercase tracking-wide">${l.title}</h4><p class="text-sm text-gray-400 font-light leading-relaxed mb-6">${l.text}</p>${l.imageUrl ? `<img src="${l.imageUrl}" class="record-image" style="max-height:200px; margin-top:0" onclick="window.openLightbox('${l.imageUrl}')">` : ''}</div>`).join('');
        }
        window.deleteLog = async (id, isPriv) => { if(!confirm("ç¡®å®šæŠ¹é™¤ï¼Ÿ")) return; await deleteDoc(doc(db, 'artifacts', appId, isPriv ? 'users' : 'public', isPriv ? window.currentUser.uid : 'data', isPriv ? 'private_logs' : 'logs', id)); };
        
        document.getElementById('postEchoBtn').onclick = async () => {
            if(!window.currentUser) return alert("æ•°æ®åº“ç¦»çº¿ã€‚AI å·²æ¿€æ´»ã€‚");
            const text = document.getElementById('newEchoInput').value.trim();
            const title = document.getElementById('postTitle').value.trim();
            const imageUrl = document.getElementById('postImageUrl').value.trim();
            const type = document.getElementById('postType').value;
            const isPriv = document.getElementById('isPrivateEntry').checked;
            if(!text) return;
            try {
                if(type === 'metrics') {
                    const p = text.split(',');
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'global'), { weight: p[0].trim(), speed: p[1].trim() }, { merge: true });
                } else {
                    const coll = isPriv ? collection(db, 'artifacts', appId, 'users', window.currentUser.uid, 'private_logs') : collection(db, 'artifacts', appId, 'public', 'data', 'logs');
                    await addDoc(coll, { text, title, type, imageUrl, createdAt: serverTimestamp(), isPrivate: isPriv });
                }
                document.getElementById('newEchoInput').value = ''; document.getElementById('postImageUrl').value = ''; document.getElementById('postTitle').value = '';
            } catch(e) { alert("åŒæ­¥å¤±è´¥ã€‚"); }
        };

        const nc = document.getElementById('narrativeCard'); 
        if(nc) nc.onclick = (e) => { if(!e.target.closest('a') && e.target.id !== 'closeArchive') { nc.querySelector('.default-content').classList.add('hidden'); document.getElementById('articleListView').classList.remove('hidden'); } };
        document.getElementById('closeArchive').onclick = (e) => { e.stopPropagation(); nc.querySelector('.default-content').classList.remove('hidden'); document.getElementById('articleListView').classList.add('hidden'); };

        startSystem();
    </script>
</body>
</html>
