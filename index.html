<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµå…‰å­˜æ ¹ | Digital Garden</title>
    
    <!-- å¼•å…¥æ ¸å¿ƒæ ·å¼åº“ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥é«˜è´¨æ„Ÿå­—ä½“ï¼šNoto Serif SC (æ€æºå®‹ä½“) + JetBrains Mono -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;600&family=JetBrains+Mono:wght@200;400&family=Dancing+Script:wght@500&display=swap" rel="stylesheet">
    
    <style>
        /* ------------------- è§†è§‰æ ¸å¿ƒç³»ç»Ÿ ------------------- */
        :root {
            --bg-color: #161412; /* æ·±ç¥ç€æš–é»‘ï¼Œé˜²æ­¢å›¾ç‰‡åŠ è½½ç¬é—´é»‘å± */
            --card-bg: rgba(28, 24, 20, 0.85); 
            --accent-color: #e3b341; 
            --text-main: #d1d5db;
            --amber-glow: rgba(227, 179, 65, 0.08);
        }

        body { 
            background-color: var(--bg-color); 
            color: var(--text-main); 
            font-family: 'Noto Serif SC', serif; 
            margin: 0; padding: 0; 
            overflow-x: hidden; 
            min-height: 100vh;
        }
        
        /* ç»ˆæç¯å¢ƒèƒŒæ™¯å±‚ï¼šç”±è„šæœ¬é©±åŠ¨çš„ã€å®æ„Ÿäººæ–‡çŸ©é˜µã€‘ */
        #dynamicBg { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-size: cover; background-position: center; 
            z-index: -1; 
            filter: brightness(0.6) contrast(1.1) saturate(1.1);
            transition: background-image 3s cubic-bezier(0.22, 1, 0.36, 1);
            /* é»˜è®¤é¦–å±ä¿éšœå›¾ï¼šä¸€å¼ æ¸©æš–çš„é›¨å¤œè¡—å¤´å±€éƒ¨ (ID: 1513506496266) */
            background-image: linear-gradient(rgba(22,20,18,0.35), rgba(22,20,18,0.75)), url('https://images.unsplash.com/photo-1513506496266-aa6d3b9954b4?q=80&w=2000&auto=format&fit=crop');
        }

        .ambient-layer { 
            position: fixed; inset: 0; 
            background: radial-gradient(circle at 50% 50%, var(--amber-glow) 0%, transparent 70%); 
            pointer-events: none; z-index: 0; 
        }

        /* ç»Ÿä¸€å¡ç‰‡æ ·å¼ï¼šBento 2.5 åŠ åšæ¯›ç»ç’ƒ */
        .bento-card { 
            background: var(--card-bg); backdrop-filter: blur(60px); 
            border: 1px solid rgba(227, 179, 65, 0.18); border-radius: 40px; 
            padding: 3rem; transition: all 0.7s cubic-bezier(0.22, 1, 0.36, 1);
            transform-style: preserve-3d;
            box-shadow: 0 25px 50px rgba(0,0,0,0.6);
        }
        .bento-card:hover { border-color: var(--accent-color); box-shadow: 0 40px 100px rgba(227, 179, 65, 0.2); transform: translateY(-8px); }

        .bento-grid { 
            display: grid; grid-template-columns: repeat(4, 1fr); 
            grid-auto-rows: minmax(200px, auto); gap: 2.5rem; 
            padding: 2rem 4rem 6rem 4rem; max-width: 1550px; margin: 0 auto; 
        }

        /* å­—ä½“ä½“ç³» */
        .mono { font-family: 'JetBrains Mono', monospace; }
        .serif { font-family: 'Noto Serif SC', serif; }
        .module-time { font-family: 'JetBrains Mono', monospace; font-size: 10px; opacity: 0.35; letter-spacing: 0.1em; }

        /* M5 æ„Ÿå®˜å®éªŒå®¤ UI ä¿®å¤ */
        .sensory-menu { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1.5rem; margin-top: 2rem; }
        .sensory-btn { 
            aspect-ratio: 1; background: rgba(255,255,255,0.03); 
            border: 1px solid rgba(255,255,255,0.06); border-radius: 28px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            transition: 0.4s; cursor: pointer; 
        }
        .sensory-btn:hover { background: var(--amber-glow); border-color: var(--accent-color); transform: scale(1.1); }
        .sensory-btn span { font-size: 10px; margin-top: 10px; opacity: 0.5; font-weight: 600; letter-spacing: 0.1em; }

        .sensory-detail-view { position: absolute; inset: 0; background: #0d0b08; z-index: 100; border-radius: 40px; padding: 2.5rem; display: none; flex-direction: column; }
        .sensory-detail-view.active { display: flex; }

        /* è¾“å…¥æ¡†å¼ºåˆ¶ç²¾è‡´åŒ– */
        .admin-input-safe { font-size: 13px !important; line-height: 1.6; font-family: 'JetBrains Mono', monospace; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.12); border-radius: 14px; padding: 0.8rem 1rem; color: white; outline: none; width: 100%; transition: 0.3s; }
        .admin-input-safe:focus { border-color: var(--accent-color); background: rgba(255,255,255,0.08); }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-dot { width: 9px; height: 9px; border-radius: 50%; display: inline-block; border: 2px solid rgba(255,255,255,0.1); }
        .status-online { background: #85a583; box-shadow: 0 0 15px #85a583; }
        .status-offline { background: #ef4444; box-shadow: 0 0 15px #ef4444; }
        .status-syncing { background: #e3b341; animation: pulse 1.5s infinite; }

        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 1024px) {
            .bento-grid { grid-template-columns: 1fr; padding: 1rem; }
            .col-span-4, .col-span-2 { grid-column: span 1; }
        }

        /* åŠŸèƒ½é¢æ¿ */
        #contactPanel { 
            position: fixed; top: 110px; right: 40px; width: 320px; 
            background: rgba(30, 25, 22, 0.99); backdrop-filter: blur(45px); 
            border: 1px solid rgba(227, 179, 65, 0.3); border-radius: 40px; 
            padding: 2.5rem; z-index: 10000; display: none; 
            transform: translateY(-20px); opacity: 0; transition: all 0.5s cubic-bezier(0.22, 1, 0.36, 1);
        }
        #loginModal { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); 
            z-index: 20000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(30px); 
        }
        #historyDrawer { position: fixed; right: -550px; top: 0; width: 500px; height: 100vh; background: rgba(18, 15, 12, 0.99); z-index: 8000; transition: 0.6s cubic-bezier(0.22, 1, 0.36, 1); border-left: 1px solid rgba(255, 255, 255, 0.05); padding: 4rem; overflow-y: auto; }
        #historyDrawer.open { right: 0; }
    </style>
</head>
<body>

    <!-- æ ¸å¿ƒè§†è§‰å±‚ -->
    <div id="dynamicBg"></div>
    <div class="ambient-layer"></div>
    <div id="imageLightbox" style="position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 25000; display: none; align-items: center; justify-content: center; cursor: zoom-out;" onclick="this.style.display='none'"><img id="lightboxImg" src="" style="max-width: 90%; max-height: 90%; border-radius: 12px; box-shadow: 0 0 80px black;"></div>

    <!-- ç®¡ç†éªŒè¯å¼¹çª— -->
    <div id="loginModal">
        <div class="bg-[#161a22] p-12 rounded-[60px] border border-white/10 w-full max-w-sm text-center shadow-3xl">
            <h3 class="mono text-[11px] uppercase tracking-[0.5em] opacity-30 mb-10 font-bold text-white">Archives_Access</h3>
            <input type="password" id="secretKeyInput" class="admin-input-reset text-center mb-10 admin-input-safe" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            <div class="flex gap-4">
                <button id="cancelLoginBtn" class="flex-1 py-4 text-[10px] mono opacity-30 hover:opacity-100 transition-opacity uppercase font-bold text-white">Cancel</button>
                <button id="confirmLogin" class="flex-1 py-4 bg-white/10 hover:bg-white/20 rounded-xl text-[10px] mono transition-all font-bold uppercase tracking-widest text-amber-500">Confirm</button>
            </div>
        </div>
    </div>

    <!-- è”ç³»å¡ç‰‡ -->
    <div id="contactPanel">
        <div class="flex justify-between items-center mb-10"><span class="mono text-[10px] opacity-40 uppercase font-bold tracking-[0.3em] w-full text-center text-amber-500">Connectivity</span><button id="closeContactBtn" class="text-white/20 hover:text-white p-2">âœ•</button></div>
        <div class="space-y-8 text-center text-white/90">
            <div class="group"><div class="text-[9px] opacity-20 mono mb-3 uppercase">Mail Address</div><div class="flex justify-between items-center bg-white/[0.02] p-4 rounded-2xl border border-white/5"><span class="text-xs mono">zjx207656@gmail.com</span><button onclick="copyText('zjx207656@gmail.com')" class="px-3 py-1.5 bg-white/5 rounded-lg text-[9px] mono text-amber-500 font-bold">COPY</button></div></div>
            <div class="group"><div class="text-[9px] opacity-20 mono mb-3 uppercase">WeChat ID</div><div class="flex justify-between items-center bg-white/[0.02] p-4 rounded-2xl border border-white/5"><span class="text-xs mono">Zj_6174</span><button onclick="copyText('Zj_6174')" class="px-3 py-1.5 bg-white/5 rounded-lg text-[9px] mono text-amber-500 font-bold">COPY</button></div></div>
        </div>
    </div>

    <div class="content-wrapper">
        <div class="container mx-auto">
            
            <!-- é¡µçœ‰ -->
            <header class="flex flex-col lg:flex-row justify-between items-center gap-8 mb-16 px-8 lg:px-16 pt-16">
                <div>
                    <h1 class="text-7xl font-bold text-white mb-2 tracking-tighter font-serif">æµå…‰å­˜æ ¹</h1>
                    <p class="text-xl text-gray-400 font-light italic serif opacity-80">å…·ä½“çš„ç”Ÿæ´»ï¼Œæ˜¯æŠµå¾¡è™šæ— çš„æœ€åä¸€é“é˜²çº¿ã€‚</p>
                </div>
                <div class="flex flex-col items-center lg:items-end gap-5">
                    <div class="flex items-center gap-8">
                        <div class="flex items-center gap-3">
                            <div id="syncIndicator" class="status-dot status-offline"></div>
                            <span id="visitorCount" class="font-bold tracking-[0.2em] text-white/40 text-xs uppercase">Connecting</span>
                        </div>
                        <div id="liveClock" class="mono text-xs text-amber-500/50 tracking-[0.35em]">00:00:00</div>
                    </div>
                    <div class="flex gap-4">
                        <button id="searchTrigger" class="p-3 bg-white/5 rounded-full hover:bg-white/10 text-white/60 hover:text-white transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                        <button id="contactTrigger" class="p-3 bg-white/5 rounded-full hover:bg-white/10 text-white/60 hover:text-amber-500 transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg></button>
                        <button id="adminLockTrigger" class="p-3 bg-white/5 rounded-full hover:bg-white/10 text-white/60 hover:text-white transition"><svg id="lockIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></button>
                    </div>
                </div>
            </header>

            <div class="bento-grid">
                <!-- M1: åˆ»åº¦ -->
                <div class="bento-card col-span-2 row-span-2 flex flex-col justify-between overflow-hidden">
                    <div class="relative z-10">
                        <div class="flex items-center gap-3 mb-10"><div class="w-2 h-2 rounded-full bg-amber-500 shadow-[0_0_15px_#e3b341]"></div><span class="mono text-[10px] uppercase tracking-[0.2em] opacity-40">Creativity Vitality</span></div>
                        <h2 class="text-4xl font-bold text-white mb-14 tracking-tight">ç”Ÿæ´»åˆ»åº¦</h2>
                        <div class="space-y-12">
                            <div>
                                <div class="flex justify-between items-baseline mb-5"><span class="text-gray-400 text-[10px] tracking-widest uppercase opacity-60">Archive Sync Status</span><span class="module-time font-bold opacity-80 text-amber-500">v20.0.0_STABLE</span></div>
                                <div class="h-[2px] w-full bg-white/10 rounded-full overflow-hidden"><div id="progressFill" class="h-full bg-white/70 w-[95%] shadow-[0_0_10px_white]"></div></div>
                                <p class="text-xl mt-12 italic text-gray-400 serif leading-relaxed">â€œåœ¨å…·ä½“çš„çº¹ç†ä¸­ï¼Œé‡æ‹¾è¢«é—å¿˜çš„æ¸©åº¦ã€‚â€</p>
                            </div>
                        </div>
                    </div>
                    <div class="pt-12 border-t border-white/5 flex gap-20 relative z-10">
                        <div><div class="text-4xl font-light text-white mono"><span id="weightVal">55.0</span><span class="text-xs opacity-20 ml-2">KG</span></div><div class="text-[9px] mono opacity-30 mt-3 uppercase tracking-[0.2em]">Weight</div></div>
                        <div><div class="text-4xl font-light text-white mono">95<span class="text-xs opacity-20 ml-2">%</span></div><div class="text-[9px] mono opacity-30 mt-3 uppercase tracking-[0.2em]">Energy</div></div>
                    </div>
                </div>

                <!-- M3: æ‘„å…¥æµ -->
                <div class="bento-card col-span-2">
                    <div class="flex justify-between items-center mb-12"><h3 class="mono text-[11px] opacity-40 uppercase tracking-[0.4em]">// Ingesting_Feed</h3><span class="module-time uppercase">Dec 20</span></div>
                    <div id="ingestList" class="space-y-10 flex-grow">
                        <div class="flex gap-6 items-start group">
                            <img src="https://images.unsplash.com/photo-1544947950-fa07a98d237f?q=80&w=200" class="w-14 h-14 object-cover rounded-2xl border border-white/5 cursor-zoom-in" onclick="window.openLightbox(this.src)">
                            <div class="flex-grow"><div class="flex justify-between items-start mb-1"><span class="text-sm font-semibold text-gray-200">ã€ŠçŒ®ç»™é˜¿å°”å‰ä¾¬çš„èŠ±æŸã€‹</span><span class="module-time">Reading</span></div><p class="text-xs text-gray-500 italic line-clamp-2 leading-relaxed">å…³äºæ™ºæ…§ä¸å­¤ç‹¬æœ€æ®‹å¿çš„å¯“è¨€ã€‚</p></div>
                        </div>
                        <div class="flex gap-6 items-start group">
                            <img src="https://images.unsplash.com/photo-1579621970563-ebec7560ff3e?q=80&w=200" class="w-14 h-14 object-cover rounded-2xl border border-white/5 cursor-zoom-in" onclick="window.openLightbox(this.src)">
                            <div class="flex-grow"><div class="flex justify-between items-start mb-1"><span class="text-sm font-semibold text-gray-200">ã€Šé‡‘é’±å¿ƒç†å­¦ã€‹</span><span class="module-time">Study</span></div><p class="text-xs text-gray-500 italic line-clamp-2 leading-relaxed">ç†è§£è´¢å¯Œï¼Œæœ¬è´¨ä¸Šæ˜¯ç†è§£äººæ€§çš„å¼±ç‚¹ã€‚</p></div>
                        </div>
                    </div>
                </div>

                <!-- M7: ç¢ç¢å¿µ -->
                <div id="musingModule" class="bento-card col-span-2 row-span-2 flex flex-col relative overflow-hidden">
                    <div class="flex justify-between items-start mb-10"><span class="mono text-[10px] opacity-30 uppercase tracking-[0.5em]">é›¶æ•£å›å“ / Echoes</span></div>
                    <div id="musingContent" class="flex-grow flex flex-col justify-center">
                        <div id="latestEcho" class="relative p-12 bg-white/[0.01] border-l-2 border-amber-500/20 rounded-r-[40px]">
                            <p id="echoText" class="text-2xl leading-relaxed text-gray-300 font-light italic serif">â€œæ¯ä¸€æ®µè¢«å†™ä¸‹çš„æ–‡å­—ï¼Œéƒ½æ˜¯å¯¹æµé€å²æœˆçš„æ¸©æŸ”å­˜æ ¹ã€‚â€</p>
                        </div>
                    </div>
                    <!-- ç®¡ç†å‘å¸ƒåŒº -->
                    <div id="adminPostArea" class="hidden space-y-6">
                        <div class="hint-box p-4 bg-amber-500/5 border-l-2 border-amber-500/50 rounded-r-xl"><p id="guideText" class="text-[11px] text-gray-400 italic">é€‰æ‹©åˆ†ç±»ä»¥è·å–å‘å¸ƒå»ºè®®...</p></div>
                        <div class="grid grid-cols-2 gap-5">
                            <select id="postType" class="admin-input-safe" onchange="updateGuide(this.value)"><option value="echo">CATEGORY: ECHO</option><option value="learning">CATEGORY: LEARNING</option><option value="entertainment">CATEGORY: ENTERTAIN</option><option value="article">CATEGORY: ARTICLE</option><option value="metrics">CATEGORY: METRICS</option></select>
                            <input type="text" id="postTitle" class="admin-input-safe" placeholder="Title">
                        </div>
                        <input type="text" id="postImageUrl" class="admin-input-safe" placeholder="Media Link (URL)">
                        <textarea id="newEchoInput" class="admin-input-safe" placeholder="Content..." rows="3"></textarea>
                        <button id="postEchoBtn" class="px-10 py-4 bg-white/10 hover:bg-white hover:text-black rounded-2xl text-[10px] mono transition-all font-bold text-white uppercase tracking-[0.5em] shadow-xl">STAMP</button>
                    </div>
                </div>

                <!-- M2: ä¹¦å†™ -->
                <div id="narrativeCard" class="bento-card col-span-2 cursor-pointer group">
                    <div class="default-content">
                        <div class="flex justify-between items-center mb-10"><span class="mono text-[10px] opacity-30 uppercase tracking-[0.5em]">ä¹¦å†™æ¡£æ¡ˆ / Narrative</span><span class="module-time text-amber-500/60 font-bold tracking-widest">Active</span></div>
                        <p class="text-3xl leading-relaxed text-gray-300 font-light italic serif group-hover:text-amber-500/90 transition-colors">â€œä¹¦å†™ï¼Œæ˜¯ä¸è‡ªæˆ‘çš„æ·±åº¦åšå¼ˆã€‚â€</p>
                        <div class="mt-8 pt-8 border-t border-white/5">
                             <a href="https://www.notion.so/Tongchuan-Past-Snippet" target="_blank" class="text-base text-gray-200 hover:text-amber-500 transition-colors font-serif italic">é“œå·å¾€äº‹ï¼šé‚£äº›è¢«é—å¿˜çš„æ—¶é—´ç¢ç‰‡</a>
                             <p class="text-[10px] text-gray-500 mt-2">åœ¨ç…¤çƒŸä¸é»„åœŸä¹‹é—´ï¼Œå¯»æ‰¾ä¸€ä»£äººçš„ç²¾ç¥æ¥å¤„ã€‚</p>
                        </div>
                    </div>
                </div>

                <!-- M5: æ„Ÿå®˜å®éªŒå®¤ -->
                <div id="sensoryCard" class="bento-card col-span-2 relative overflow-hidden">
                    <div id="sensoryMain">
                        <div class="flex justify-between items-center mb-10"><h3 class="mono text-[11px] opacity-40 uppercase tracking-[0.6em]">// Sensory_Memory</h3><span class="module-time uppercase text-amber-500/50 font-bold">STUBS</span></div>
                        <div class="sensory-menu">
                            <div class="sensory-btn" onclick="openSensoryCategory('åŠ¨æ¼«')">ğŸ•<span>åŠ¨æ¼«</span></div>
                            <div class="sensory-btn" onclick="openSensoryCategory('æ¸¸æˆ')">ğŸ®<span>æ¸¸æˆ</span></div>
                            <div class="sensory-btn" onclick="openSensoryCategory('ç”µå½±')">ğŸ¬<span>ç”µå½±</span></div>
                            <div class="sensory-btn" onclick="openSensoryCategory('é£æ™¯')">ğŸŒ²<span>é£æ™¯</span></div>
                            <div class="sensory-btn" onclick="openSensoryCategory('éŸ³ä¹')">ğŸ“»<span>éŸ³ä¹</span></div>
                        </div>
                    </div>
                    <div id="sensoryDetail" class="sensory-detail-view">
                        <div class="flex justify-between items-center mb-6">
                            <h4 id="categoryTitle" class="text-xs font-bold text-amber-500 tracking-widest uppercase"></h4>
                            <button onclick="closeSensoryCategory()" class="text-xs text-white/30 hover:text-white mono uppercase font-bold">[ BACK ]</button>
                        </div>
                        <div id="categoryContent" class="grid grid-cols-2 gap-4 overflow-y-auto mt-6"></div>
                    </div>
                </div>

                <!-- M6: èµ„äº§çœ‹æ¿ -->
                <div id="investCard" class="bento-card col-span-4 min-h-[450px]">
                    <div class="flex justify-between items-start mb-12"><h3 class="mono text-[11px] opacity-40 uppercase tracking-[0.8em]">Wealth Pulse Monitor</h3><span class="module-time uppercase font-bold text-amber-500/60 tracking-widest">Live_Sync</span></div>
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-12 items-center">
                        <!-- åˆ†ç±»å½’ä½ -->
                        <div class="flex flex-col gap-6 text-xs text-gray-400 font-mono italic">
                            <div class="p-4 border-l-2 border-amber-500/50 pl-5 bg-white/[0.01] rounded-r-lg">FUND: åŸºé‡‘ç»„åˆ</div>
                            <div class="p-4 border-l-2 border-white/5 pl-5 hover:border-amber-500/30 transition-colors">STOCK: è‚¡ç¥¨ä»“ä½</div>
                            <div class="p-4 border-l-2 border-white/5 pl-5 hover:border-amber-500/30 transition-colors">CRYPTO: æ•°å­—èµ„äº§</div>
                            <div class="p-4 border-l-2 border-white/5 pl-5 hover:border-amber-500/30 transition-colors">METAL: è´µé‡‘å±</div>
                        </div>
                        <div class="lg:col-span-3 flex justify-center items-center h-[280px] opacity-10 mono text-3xl tracking-[1.8em] border border-dashed border-white/10 rounded-[50px] animate-pulse">
                            DATA_VISUAL_CORE
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- ä¾§è¾¹æ  -->
    <aside id="historyDrawer">
        <div class="flex justify-between items-center mb-16"><h2 class="text-3xl font-bold text-white tracking-tight font-serif">å­˜æ¡£å®ˆæœ›</h2><button id="closeHistoryBtn" class="text-3xl text-gray-500 hover:text-white transition-colors">âœ•</button></div>
        <div class="bg-white/5 p-8 rounded-[40px] mb-12 border border-white/5 shadow-2xl">
            <div id="guardianMsg" class="text-sm text-gray-300 leading-relaxed mb-6 hidden border-l-2 border-amber-500 pl-6 bg-white/[0.02] p-4 rounded-r-2xl"></div>
            <input type="text" id="aiInput" class="admin-input-safe text-sm mb-4" placeholder="æ£€ç´¢å†å²å…±é¸£...">
            <button id="aiQueryBtn" class="w-full py-4 bg-amber-500/10 hover:bg-amber-500/20 text-amber-500 text-[10px] font-bold rounded-2xl transition uppercase tracking-widest">Query DeepSeek</button>
        </div>
        <div id="timelineContainer" class="space-y-12"></div>
    </aside>

    <audio id="ambientAudio" loop preload="auto"><source src="https://www.soundjay.com/nature/sounds/fireplace-1.mp3" type="audio/mpeg"></audio>

    <!-- è„šæœ¬åŒºåŸŸï¼šå…¨é‡æ‰©å……é€»è¾‘ -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ADMIN_SECRET = "Zjx207661";
            window.HARDCODED_DEEPSEEK_KEY = "sk-437d432e53664e489b60a9349619a879";

            /**
             * ç»ˆæç¯å¢ƒå¼•æ“ v20.0ï¼šã€ç»å¯¹äººæ–‡å®åœ°æ¸…å•ã€‘
             * å½»åº•åˆ é™¤äº†æ‰€æœ‰å…‰æ–‘ IDã€é«˜æ¥¼ IDã€éšæœºæœç´¢è¯ã€‚
             * æ¯ä¸€å¼ å›¾éƒ½åŒ…å«å…·ä½“çš„å®ç‰©ï¼šç¯æ†ã€é•¿æ¤…ã€çŸ³æ¿ã€å£ç‚‰ã€è€ä¹¦ã€‚
             */
            const SOUL_RECORDS = {
                spring: ["1516315727037-d15f0288be00", "1501785832662-75d16c96a721", "1493857671297", "1513506496266"], 
                summer: ["1507500152103-af50854731c2", "1464306271587", "1528605105344", "1465224554447-da7c92842c3d"], 
                autumn: ["1508066590774-7744a7d35881", "1509133917303-311355cf9a4a", "1520690214124", "1513506496266"], 
                winter: ["1418985991508", "1483321507767-f136b8089304", "1516012891152", "1452697771746"]  
            };

            function updateEnvironment() {
                const now = new Date();
                const month = now.getMonth() + 1;
                const hour = now.getHours();
                
                // 1. ç¡®å®šå­£èŠ‚
                let season = (month >= 3 && month <= 5) ? 'spring' : (month >= 6 && month <= 8) ? 'summer' : (month >= 9 && month <= 11) ? 'autumn' : 'winter';
                const pool = SOUL_RECORDS[season];
                
                // 2. ç‰©ç† ID é”å®šï¼ˆæ ¸å¿ƒï¼šåŠ å…¥ v20.0 ç‰ˆæœ¬ç­¾åå¼ºè¡Œç©¿é€ç¼“å­˜ï¼‰
                const photoId = pool[Math.floor(Math.random() * pool.length)];
                const dynamicUrl = `https://images.unsplash.com/photo-${photoId}?q=80&w=2000&auto=format&fit=crop&v=20.0&sig=${now.getTime()}`;
                
                const bgEl = document.getElementById('dynamicBg');
                if(bgEl) {
                    const img = new Image();
                    img.src = dynamicUrl;
                    img.onload = () => {
                        bgEl.style.backgroundImage = `linear-gradient(rgba(22,20,18,0.35), rgba(22,20,18,0.75)), url('${dynamicUrl}')`;
                    };
                    img.onerror = () => {
                        // å¦‚æœç½‘ç»œæå…¶ç³Ÿç³•ï¼Œå›é€€åˆ°ç»å…¸å›¾
                        bgEl.style.backgroundImage = `linear-gradient(rgba(22,20,18,0.35), rgba(22,20,18,0.75)), url('https://images.unsplash.com/photo-1513506496266-aa6d3b9954b4?q=80&w=2000')`;
                    }
                }
            }
            updateEnvironment();

            // åŸºç¡€åŠŸèƒ½ç»‘å®šï¼ˆå¸¦ null æ£€æŸ¥ï¼Œé˜²æ­¢æŠ¥é”™ï¼‰
            const safeBind = (id, event, fn) => {
                const el = document.getElementById(id);
                if(el) el.addEventListener(event, fn);
            };

            window.toggleContact = () => {
                const p = document.getElementById('contactPanel');
                if(!p) return;
                const isActive = p.style.display === 'block';
                if(isActive) {
                    p.style.opacity = '0';
                    p.style.transform = 'translateY(-20px)';
                    setTimeout(() => p.style.display = 'none', 500);
                } else {
                    p.style.display = 'block';
                    setTimeout(() => { p.style.opacity = '1'; p.style.transform = 'translateY(0)'; }, 10);
                }
            };

            window.openSensoryCategory = (cat) => {
                const t = document.getElementById('categoryTitle'); if(t) t.innerText = `Sensory // ${cat}`;
                const l = document.getElementById('categoryContent');
                if(l) {
                    const data = (window._allLogs || []).filter(item => item.type === 'entertainment' && item.title === cat);
                    l.innerHTML = data.length ? data.map(i => `
                        <div class="bg-white/5 p-4 rounded-3xl border border-white/5 group transition-all hover:bg-white/10">
                            <img src="${i.imageUrl}" class="w-full h-32 object-cover rounded-2xl mb-3 cursor-zoom-in" onclick="window.openLightbox(this.src)">
                            <p class="text-[11px] opacity-60 leading-relaxed italic">${i.text}</p>
                        </div>`).join('') : '<div class="col-span-2 text-center text-xs opacity-20 py-20 mono">NO_RECORDS_FOUND</div>';
                }
                const d = document.getElementById('sensoryDetail'); if(d) d.classList.add('active');
            };

            window.closeSensoryCategory = () => {
                const d = document.getElementById('sensoryDetail'); if(d) d.classList.remove('active');
            };

            window.openLightbox = (src) => {
                const box = document.getElementById('imageLightbox');
                const img = document.getElementById('lightboxImg');
                if(box && img) { img.src = src; box.style.display = 'flex'; }
            };

            window.copyText = (t) => {
                const el = document.createElement('textarea'); el.value = t; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el); alert("å·²åŒæ­¥è‡³å‰ªè´´æ¿ã€‚");
            };

            window.updateGuide = (val) => {
                const g = document.getElementById('guideText');
                const dict = {"echo": "åŒæ­¥è‡³éšç¬”æµæ°´ã€‚", "metrics": "æ›´æ–°ä½“é‡/åˆ›æ„å€¼ç­‰é‡åŒ–æŒ‡æ ‡ã€‚", "learning": "è®°å½•é˜…è¯»ä¸å­¦ä¹ åŠ¨æ€ã€‚"};
                if(g) g.innerText = dict[val] || "é€‰æ‹©åˆ†ç±»è·å–å»ºè®®...";
            };

            // ç»‘å®šä¾§è¾¹æ 
            safeBind('searchTrigger', 'click', () => document.getElementById('historyDrawer').classList.add('open'));
            safeBind('closeHistoryBtn', 'click', () => document.getElementById('historyDrawer').classList.remove('open'));
            
            // ç»‘å®šè”ç³»æ–¹å¼
            safeBind('contactTrigger', 'click', window.toggleContact);
            safeBind('closeContactBtn', 'click', window.toggleContact);

            // ç»‘å®šç®¡ç†å‘˜
            safeBind('adminLockTrigger', 'click', () => {
                if (localStorage.getItem('is_garden_admin') === 'true') {
                    localStorage.removeItem('is_garden_admin'); window.isAdmin = false;
                    document.getElementById('lockIcon').classList.remove('text-amber-500');
                    document.getElementById('adminPostArea').classList.add('hidden');
                    alert("ä¸»ç†äººä¼šè¯å·²ç»“æŸã€‚");
                } else {
                    document.getElementById('loginModal').style.display = 'flex';
                }
            });

            safeBind('cancelLoginBtn', 'click', () => document.getElementById('loginModal').style.display = 'none');

            safeBind('confirmLogin', 'click', () => {
                const inp = document.getElementById('secretKeyInput');
                if(inp && inp.value === ADMIN_SECRET) {
                    localStorage.setItem('is_garden_admin', 'true'); window.isAdmin = true;
                    document.getElementById('loginModal').style.display = 'none';
                    const area = document.getElementById('adminPostArea');
                    if(area) area.classList.remove('hidden');
                    document.getElementById('lockIcon').classList.add('text-amber-500');
                    alert("èº«ä»½å·²é”šå®šã€‚");
                } else alert("å£ä»¤é”™è¯¯ã€‚");
            });

            // å¯åŠ¨æ—¶é’Ÿ
            setInterval(() => { const c = document.getElementById('liveClock'); if(c) c.innerText = new Date().toLocaleTimeString(); }, 1000);
            
            // å…¨å±€çŠ¶æ€æ¢å¤
            if(localStorage.getItem('is_garden_admin') === 'true') {
                window.isAdmin = true;
                const area = document.getElementById('adminPostArea');
                if(area) area.classList.remove('hidden');
                const icon = document.getElementById('lockIcon');
                if(icon) icon.classList.add('text-amber-500');
            }
        });
    </script>

    <!-- Firebase é€»è¾‘ï¼šä¸¥æ ¼æƒé™è§„èŒƒ (Rule 1, Rule 3) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, addDoc, collection, onSnapshot, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        async function initSystem() {
            try {
                const firebaseConfig = JSON.parse(__firebase_config);
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const initialToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app); 
                const db = getFirestore(app);

                // RULE 3 - å¿…é¡»å…ˆæ‰§è¡Œ Auth
                if (initialToken) { await signInWithCustomToken(auth, initialToken); } 
                else { await signInAnonymously(auth); }

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        const syncInd = document.getElementById('syncIndicator');
                        if(syncInd) syncInd.className = "status-dot status-online";
                        const vCountEl = document.getElementById('visitorCount');
                        
                        // è®¿å®¢è®°å½•é€»è¾‘ï¼šRule 1 è·¯å¾„
                        const statsDoc = doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'visitors');
                        await setDoc(statsDoc, { count: increment(1) }, { merge: true }).catch(()=>{});
                        
                        onSnapshot(statsDoc, (snap) => {
                            if(snap.exists() && vCountEl) vCountEl.innerText = snap.data().count.toLocaleString();
                        });

                        // æ•°æ®æ—¥å¿—ç›‘å¬
                        const logsColl = collection(db, 'artifacts', appId, 'public', 'data', 'logs');
                        onSnapshot(logsColl, (snapshot) => {
                            window._allLogs = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                            // å¦‚æœæœ‰æœ€æ–°çš„ç¢ç¢å¿µï¼Œå®æ—¶æ›´æ–° M7
                            const echos = window._allLogs.filter(l => l.type === 'echo').sort((a,b) => (b.createdAt?.seconds||0) - (a.createdAt?.seconds||0));
                            if(echos[0]) document.getElementById('echoText').innerText = echos[0].text;
                        }, (err) => {
                             if(vCountEl) vCountEl.innerText = "LOCAL_CACHE";
                        });

                        // ç»‘å®šå‘å¸ƒæŒ‰é’®
                        const postBtn = document.getElementById('postEchoBtn');
                        if(postBtn) postBtn.onclick = async () => {
                            const text = document.getElementById('newEchoInput').value.trim();
                            if(!text) return;
                            const type = document.getElementById('postType').value;
                            try {
                                await addDoc(logsColl, {
                                    text, type,
                                    title: document.getElementById('postTitle').value,
                                    imageUrl: document.getElementById('postImageUrl').value,
                                    createdAt: serverTimestamp()
                                });
                                alert("å­˜æ ¹å·²è®°å½•ã€‚");
                                document.getElementById('newEchoInput').value = '';
                            } catch(e) { alert("åŒæ­¥å¤±è´¥: " + e.message); }
                        };
                    }
                });
            } catch(e) { console.log("Firebase Fallback to Offline."); }
        }
        initSystem();
    </script>
</body>
</html>
